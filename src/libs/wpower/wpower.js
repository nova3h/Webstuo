var __webpack_modules__={138:(e,t,i)=>{i.d(t,{A:()=>n});const a=class{_____IO_____(){}static async read_file(e=null){try{if(null==e){const[e]=await window.showOpenFilePicker(),t=await e.getFile();return[e,await t.text()]}const t=await e.getFile();return[e,await t.text()]}catch(e){return logw("files.js/read_file:",e),[null,null]}}static async write_file(e,t){e.requestPermission({mode:"readwrite"});const i=await e.createWritable();return await i.write(t),await i.close(),e}static async write_new_file(e,t="noname.txt"){try{const i=await window.showSaveFilePicker({suggestedName:t});return await a.write_file(i,e)}catch(e){return logw("files.js/write_new_file:",e),null}}static async file_exists(e){try{return File_Handle.getFile(),!0}catch{return!1}}static async dir_exists(e){try{for await(let t of e.values())break;return!0}catch{return!1}}_____PERMISSIONS_____(){}static async make_rw(e){return await e.requestPermission({mode:"readwrite"})}_____DIR_____(){}static async pick_dir(){try{return await window.showDirectoryPicker({mode:"readwrite"})}catch(e){return logw("files.js/pick_dir:",e),null}}static async dir_get_items(e){e.requestPermission({mode:"readwrite"});var t=[];for await(const i of e.values())t.push(i);return t}static async dir_get_subdirs(e){var t=await a.dir_get_items(e),i=[];for(let e of t)"directory"==e.kind&&i.push(e);return i}static async dir_get_files(e){var t=await a.dir_get_items(e),i=[];for(let e of t)"file"==e.kind&&i.push(e);return i}static async dir_path2dir(e,t){try{var i=t.split("/"),a=e;for(let e of i)a=await a.getDirectoryHandle(e,{create:!0});return a}catch(e){return loge("Error:",e),null}}static async dir_path2file(e,t){try{var i=t.split("/"),a=e;for(let e=0;e<i.length-1;e++){let t=i[e];a=await a.getDirectoryHandle(t,{create:!0})}var n=i.length;return await a.getFileHandle(i[n-1],{create:!0})}catch(e){return loge("Error:",e),null}}static async dir_dir_exists(e,t){try{var i=t.split("/"),a=e;for(let e=0;e<i.length;e++){let t=i[e];a=await a.getDirectoryHandle(t,{create:!1})}return!0}catch{return!1}}static async dir_file_touch(e,t){return await a.dir_path2file(e,t)}static async dir_file_exists(e,t){try{if(null==t||0==t.trim().length)return!1;var i=t.split("/"),a=e;for(let e=0;e<i.length-1;e++){let t=i[e];a=await a.getDirectoryHandle(t,{create:!0})}var n=i.length;return await a.getFileHandle(i[n-1],{create:!1}),!0}catch{return!1}}},n=a},283:(e,t,i)=>{i.d(t,{A:()=>_});var a=i(601),n=i.n(a),r=i(314),s=i.n(r)()(n());s.push([e.id,".wp-richtext {\n    resize:vertical; height:calc(50vh - 7 * var(--line-h));\n    border:1px solid silver; overflow:auto; outline:none;\n}\n.wp-rt-btn {\n    height:var(--line-h); vertical-align:bottom;\n}\n/* EOF */",""]);const _=s},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",a=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),a&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),a&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,a,n,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var _=0;_<this.length;_++){var l=this[_][0];null!=l&&(s[l]=!0)}for(var o=0;o<e.length;o++){var d=[].concat(e[o]);a&&s[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),i&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=i):d[2]=i),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},453:(e,t,i)=>{i.d(t,{A:()=>_});var a=i(601),n=i.n(a),r=i(314),s=i.n(r)()(n());s.push([e.id,".wp-color-cell {\n    width:1.5rem; display:inline-block; border:1px solid silver;\n}\n/* EOF */",""]);const _=s},473:(e,t,i)=>{i.d(t,{A:()=>g});var a=i(620),n=i(842),r=i(658);function s(e){var t=(e=Math.floor(e)%256).toString(16);return t.length<2&&(t="0"+t),t}class _ extends r.A{constructor(){super()}get_colors(e){var t=Math.floor,i=255/e,a=[];for(let n=0;n<=e;n++)for(let r=0;r<=e;r++)for(let s=0;s<=e;s++)a.push({r:t(n*i),g:t(r*i),b:t(s*i)});for(let e=0;e<a.length;e++)a[e]="#"+s(a[e].r)+s(a[e].g)+s(a[e].b);return a}_____CORE_____(){}init(){super.init(this),this.Data.Colors=this.get_colors(5)}render(){}async load_data(){}}const l=_;var o=i(453);class d extends r.A{constructor(){super()}_____UTILS_____(){}insert(e){var t=new_ele("span");t.innerHTML=e;var i=window.getSelection();i.getRangeAt(0).insertNode(t),i.collapseToEnd()}_____UI_ACTIONS_____(){}insert_dot(e){this.insert("<ul><li>&#32;</li></ul>")}insert_num(e){this.insert("<ol><li>&#32;</li></ol>")}insert_emptytick(e){this.insert("◻&nbsp;")}insert_tick(e){this.insert("✓&nbsp;")}_____UI_EVENTS_____(){}on_edit_key(e){}_____CORE_____(){}init(){super.init(this)}render(){}async load_data(){}}const c=d;var u=i(283);function h(e,t,i){return e[i]<t[i]?-1:e[i]>t[i]?1:0}class f{static menu_shown=!1;static Treeitem_Displays={};_____UTILS_____(){}static get_ele_value(e){var t=e.value.trim();return[e.attr("class").trim().split(" ")[0].split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("_"),t]}_____BASICS_____(){}static async alert(e,t=null){var i=Math.random().toString().replace(".",""),a=new_ele("div");a.attr("id","Alert"+i),a.css({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"});var n=`<style>\n            @media(max-width:999px){\n                .ui-alert-box { width:100vw !important; left:0 !important; }\n            }\n        </style>\n        <span style="width:100vw; height:100vh; background-color:black;\n            opacity:.5;">&nbsp;</span>\n        <span class="ui-alert-box" style="width:50vw; height:50vh; background-color:white;\n                position:fixed; left:25vw; top:25vh;">\n            <div style="background-color:#ddd; padding-left:var(--line-h);">\n                <big>${__h("MESSAGE")}</big>\n            </div>\n            <div style="padding:var(--line-h); max-height:calc(50vh - 2 * var(--line-h));\n                overflow:auto;">${e}</div>\n            <div style="background-color:#eee; padding-left:var(--line-h);\n                    line-height:calc(1 * var(--line-h));">\n                <button id="Alertok${i}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("OKAY")}\n                </button>\n            </div>\n        </span>`;a.innerHTML=n,d$("body").appendChild(a);var r=d$("#Alertok"+i),[s,_]=new_lock();r.on("click",(e=>{_(null),d$("#Alert"+i).remove()})),null!=t&&t(a),await s}static async confirm(e){var t=Math.random().toString().replace(".",""),i=new_ele("div");i.attr("id","Confirm"+t),i.css({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"});var a=`<style>\n            @media(max-width:999px){\n                .ui-cf-box { width:100vw !important; left:0 !important; }\n            }\n        </style>\n        <span style="width:100vw; height:100vh; background-color:black;\n            opacity:.5;">&nbsp;</span>\n        <span class="ui-cf-box" style="width:50vw; height:50vh; background-color:white;\n                position:fixed; left:25vw; top:25vh;">\n            <div style="background-color:#ddd; padding-left:var(--line-h);">\n                <big>${__h("CONFIRMATION")}</big>\n            </div>\n            <div style="padding:var(--line-h); max-height:calc(50vh - 2 * var(--line-h));\n                overflow:auto;">${e}</div>\n            <div style="background-color:#eee; padding-left:var(--line-h);\n                    line-height:calc(1 * var(--line-h));">\n                <button id="Confirmyes${t}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("YES")}\n                </button> &nbsp;\n                <button id="Confirmno${t}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("NO")}\n                </button>\n            </div>\n        </span>`;i.innerHTML=a,d$("body").appendChild(i);var[n,r]=new_lock();return d$("#Confirmyes"+t).on("click",(e=>{r("yes"),d$("#Confirm"+t).remove()})),d$("#Confirmno"+t).on("click",(e=>{r("no"),d$("#Confirm"+t).remove()})),await n}static async prompt(e,t="",i=""){var a=Math.random().toString().replace(".",""),n=new_ele("div");n.attr("id","Input"+a),n.css({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"});var r=`<style>\n            @media(max-width:999px){\n                .ui-prom-box { width:100vw !important; left:0 !important; }\n            }\n        </style>\n        <span style="width:100vw; height:100vh; background-color:black;\n            opacity:.5;">&nbsp;</span>\n        <span class="ui-prom-box" style="width:50vw; height:50vh; background-color:white;\n                position:fixed; left:25vw; top:25vh;">\n            <div style="background-color:#ddd; padding-left:var(--line-h);">\n                <big>${__h("INPUT")}</big>\n            </div>\n            <div style="padding:var(--line-h); max-height:calc(50vh - 2 * var(--line-h));\n                    overflow:auto;">\n                ${e}<br>\n                <input id="Inp${a}" type="${i}" style="width:100%;"/>\n            </div>            \n            <div style="background-color:#eee; padding-left:var(--line-h);\n                    line-height:calc(1 * var(--line-h));">\n                <button id="Inputok${a}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("OKAY")}\n                </button> &nbsp;\n                <button id="Inputcancel${a}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("CANCEL")}\n                </button>\n            </div>\n        </span>`;n.innerHTML=r,d$("body").appendChild(n);var s=d$("#Inp"+a);s.focus(),s.value=t;var[_,l]=new_lock();return d$("#Inputok"+a).on("click",(e=>{l(s.value.trim()),d$("#Input"+a).remove()})),d$("#Inputcancel"+a).on("click",(e=>{l(null),d$("#Input"+a).remove()})),d$("#Inp"+a).on("keydown",(e=>"Enter"==e.key?(l(s.value.trim()),void d$("#Input"+a).remove()):"Escape"==e.key?(l(null),void d$("#Input"+a).remove()):void 0)),await _}static async select(e,t,i=null,a=!1){var n=Math.random().toString().replace(".",""),r=new_ele("div");if(r.attr("id","Select"+n),r.css({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"}),!0===a)var s="multiple",_="calc(10 * var(--line-h))",l="max-height:calc((50vh - 2 * var(--line-h)) / 2);",o=`<div><small>${__h("PRESS_CTRL_TO_SELECT_MULTIPLE")}</small></div>`;else s="",_="var(--line-h)",l="",o="";var d="";for(let e in t)d+=e==i?`<option value="${esca(e)}" selected>${__h(t[e])}</option>`:`<option value="${esca(e)}">${__h(t[e])}</option>`;var c=`<style>\n            @media(max-width:999px){\n                .ui-sel-box { width:100vw !important; left:0 !important; }\n            }\n        </style>\n        <span style="width:100vw; height:100vh; background-color:black;\n            opacity:.5;">&nbsp;</span>\n        <span class="ui-sel-box" style="width:50vw; height:50vh; background-color:white;\n                position:fixed; left:25vw; top:25vh;">\n            <div style="background-color:#ddd; padding-left:var(--line-h);">\n                <big>${__h("SELECT")}</big>\n            </div>\n            <div style="padding:var(--line-h); max-height:calc(50vh - 2 * var(--line-h));\n                overflow:auto;">${e}${o}\n            </div>            \n            <div>\n                <select id="Selectinp${n}" ${s} style="margin-left:var(--line-h);\n                    height:${_}; width:calc(50vw - 2 * var(--line-h));\n                    font-size:var(--f-size); ${l}">${d}</select>\n            </div>\n            <div>&nbsp;</div>\n            <div style="background-color:#eee; padding-left:var(--line-h);\n                    line-height:calc(1 * var(--line-h));">\n                <button id="Selectok${n}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("OKAY")}\n                </button>\n                <button id="Selectcancel${n}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("CANCEL")}\n                </button>\n            </div>\n        </span>`;r.innerHTML=c,d$("body").appendChild(r);var[u,h]=new_lock();return d$("#Selectok"+n).on("click",(e=>{h(0==a?d$("#Selectinp"+n).value:[...d$("#Selectinp"+n).selectedOptions].map((e=>e.value))),d$("#Select"+n).remove()})),d$("#Selectcancel"+n).on("click",(e=>{h(null),d$("#Select"+n).remove()})),await u}static async select_many(e,t,i=null){return await p.select(e,t,i,!0)}static async select_with_btns(e,t,i={}){if(null==i.Item_Width)var a="100%";else a=i.Item_Width;var n="";for(let e in t)n+=`<button value-text="${esca(e)}" class="wp-select-item-btn"\n            style="width:${a}; text-align:left;">${esch(t[e])}</button>`;e=null!=e?`<div>${e}<div>&nbsp;</div></div>${n}`:n;var[r,s]=new_lock(),_=p.alert(e,(e=>{for(let t of e$$(e,".wp-select-item-btn"))t.on("click",(t=>{s(t.target.attr("value-text")),e.remove()}));!0===i.close_on_outerclick&&e$(e,".ui-alert-box").previousElementSibling.on("click",(()=>{s(null),e.remove()}))}));return await Promise.race([r,_])}static async dialog(e,t,i={},a=null){var n=Math.random().toString().replace(".",""),r=new_ele("div");r.attr("id","Dialog"+n),r.attr("class","wpower-dlg"),r.css({position:"fixed",left:0,top:0,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent"});var[s,_]=cvm_.render_com(t,i,"get-all"),_=`<style>\n            @media(max-width:999px){\n                .ui-dlg-box { width:100vw !important; left:0 !important; }\n            }\n        </style>\n        <span style="width:100vw; height:100vh; background-color:black;\n            opacity:.5;">&nbsp;</span>\n        <span class="ui-dlg-box" style="width:50vw; height:50vh; background-color:white;\n                position:fixed; left:25vw; top:25vh;">\n            <div style="background-color:#ddd; padding-left:var(--line-h);">\n                <big>${e}</big>\n            </div>\n            <div style="padding:var(--line-h); max-height:calc(50vh - 2 * var(--line-h));\n                overflow:auto;">${_}</div>\n            <div class="wp-dlg-btns" style="background-color:#eee; padding-left:var(--line-h);\n                    line-height:calc(1 * var(--line-h));">\n                <button id="Dialogok${n}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("OKAY")}\n                </button>\n            <button id="Dialogcancel${n}" style="transform:scale(1);\n                        transform-origin:top left; vertical-align:top;\n                        height:calc(1 * var(--line-h)); padding-left:1.5rem;\n                        padding-right:1.5rem;">\n                    ${__h("CANCEL")}\n                </button>\n            </div>\n        </span>`;r.innerHTML=_,d$("body").appendChild(r);var l=`div[key="${s.Key}"]`;s.Wrapper=e$(r,l),d$(l).Controller=s;var[o,d]=new_lock();return d$("#Dialogok"+n).on("click",(e=>{var t={},i=e$$(r,"input"),a=e$$(r,"select"),s=e$$(r,"textarea");for(let e of[...i,...a,...s]){let[i,a]=p.get_ele_value(e);t[i]=a}var _=e$$(r,"*[contenteditable]");for(let e of _){let i=e.classList[0];null!=i&&0!=i.trim().length||logw("ui.js/dialog: Bad contenteditable class:",i),t[i]=e.innerHTML.trim()}d(t),d$("#Dialog"+n).remove()})),d$("#Dialogcancel"+n).on("click",(e=>{d(null),d$("#Dialog"+n).remove()})),null!=a&&a(r),await o}static no_dlg_buttons(){var e=d$$(".wp-dlg-btns");for(let t of e)t.remove()}static close_dialogs(){var e=d$$(".wpower-dlg");for(let t of e)t.remove()}static notif(e,t="black"){if(null==d$("#Notif-Col")){let e=new_ele("div");e.attr("id","Notif-Col"),e.css({height:"auto",position:"fixed",right:0,bottom:0,display:"flex",alignItems:"flex-start",justifyContent:"flex-end",flexDirection:"column"}),d$("body").appendChild(e)}var i="Notif"+Math.random().toString().replace(".",""),a=d$("#Notif-Col"),n=new_ele("div");n.attr("id",i),n.innerHTML=e,n.css({padding:"1.5rem",backgroundColor:"#eee",color:t,borderRadius:"1rem",border:"1px solid white"}),a.appendChild(n),n.on("click",(()=>{d$("#"+i)?.remove()})),setTimeout((()=>{d$("#"+i)?.remove()}),5e3)}static native_notif(e){Notification.requestPermission().then((()=>{new Notification(e)}))}_____ADVANCED_____(){}static async pick_color(){var e=null,t=p.dialog(__h("PICK_COLOUR"),"color-picker",{}),[i,a]=new_lock();for(let t of d$$(".wp-color-cell"))t.on("click",(t=>{e=t.target.attr("color"),a(e),p.close_dialogs()}));return t.then((()=>{a(null)})),await i}static async prompt_richtext(e,t="",i=!1){var a=await p.dialog(__h("INPUT"),"richtext-edit",{Msg_Html:e,Default:t});if(null==a)return null;if(0==i)return a.richtext.trim();var n=new_ele("div");return n.innerHTML=a.richtext.replaceAll("<"," <"),n.innerText.trim().replace(/[\s]{2,}/g," ")}_____Svg_____(){}static ensure_svg(e){var t;if(null==e$(e,"svg")){t=new_ele_svg("svg");let i=e.rect(),n=i.width,r=i.height,s=a.A.get_borders(e);if(n-=s.left+s.right,r-=s.top+s.bottom,t.attr("width",n),t.attr("height",r),t.css({display:"block",width:n+"px",height:r+"px"}),t.attr("viewBox",`0 0 ${n} ${r}`),0==e.children.length)e.appendChild(t);else{let i=e$(e,"*:nth-child(1)");e.insertBefore(t,i)}}else t=e$(e,"svg");return t}static add_line(e,t,i,a,n,r,s=1){var _=p.ensure_svg(e),l=new_ele_svg("line");l.attrs_set({x1:t,y1:i,x2:a,y2:n,style:`stroke:${r}; stroke-width:${s};`}),_.appendChild(l)}static add_arrow(e,t,i,a,n,r,s=""){var _=p.ensure_svg(e),l=new_ele_svg("marker"),o=rand_id_str("Arrow");l.attrs_set({id:o,refX:10,refY:5,markerWidth:50,markerHeight:50,orient:"auto"});var d=new_ele_svg("path");d.attrs_set({d:"M0,0 L11,5 L0,10 L9,5 Z",fill:r}),l.appendChild(d),_.appendChild(l);var c=new_ele_svg("line");c.attrs_set({x1:t,y1:i,x2:a,y2:n,style:`stroke:${r}; stroke-width:2;`,"marker-end":`url(#${o})`}),_.appendChild(c);var u=(t+a)/2,h=(i+n)/2,f=new_ele_svg("text");f.attrs_set({x:u,y:h,"dominant-baseline":"middle","text-anchor":"middle"}),f.css({fontSize:"x-small",userSelect:"none"}),f.textContent=s,_.appendChild(f)}static add_rectangle(e,t,i,a,n,r){var s=p.ensure_svg(e),_=new_ele_svg("rect");_.attrs_set({x:t,y:i,width:a-t,height:n-i,fill:"rgba(0,0,0,.05)",stroke:r,rx:5,ry:5}),s.appendChild(_)}static distance(e,t,i,a){return Math.sqrt((e-i)**2+(t-a)**2)}static intersect_segments(e,t,i,a,n,r,s,_){var l,o,d,c,u,h,f=-(d=s-n)*(o=a-t)+(l=i-e)*(c=_-r);return 0==f?null:(h=(d*(t-r)-c*(e-n))/f,(u=(-o*(e-n)+l*(t-r))/f)>=0&&u<=1&&h>=0&&h<=1?{x:e+h*l,y:t+h*o}:null)}static add_arrow_box2box(e,t,i,a,n,r=!1){var s=t.x+t.width/2,_=t.y+t.height/2,l=i.x+i.width/2,o=i.y+i.height/2;const d=p.distance;var c=l-i.width/2,u=o,h=l+i.width/2,f=o,g=l,w=o-i.height/2,m=l,v=o+i.height/2,y=s-t.width/2,b=_-t.height/2,x=s+t.width/2,E=_-t.height/2,A=s-t.width/2,$=_+t.height/2,k=s+t.width/2,N=_+t.height/2;if(!0===r)var C=[{x:g,y:w}];else C=[{x:c,y:u},{x:h,y:f},{x:g,y:w},{x:m,y:v}];C.sort(((e,t)=>d(s,_,e.x,e.y)-d(s,_,t.x,t.y)));var I=C[0],S=I.x,O=I.y,T=!1,D=p.intersect_segments(s,_,S,O,y,b,x,E);null!=D&&(s=D.x,_=D.y,T=!0),T||null!=(D=p.intersect_segments(s,_,S,O,A,$,k,N))&&(s=D.x,_=D.y,T=!0),T||null!=(D=p.intersect_segments(s,_,S,O,y,b,A,$))&&(s=D.x,_=D.y,T=!0),T||null!=(D=p.intersect_segments(s,_,S,O,x,E,k,N))&&(s=D.x,_=D.y,T=!0),p.add_arrow(e,s,_,S,O,a,n)}_____Graph_____(){}static snap_to_grid(e,t,i,a=!1,n=!1){var r=100/e.grid_size_w,s=100/e.grid_size_h;return n?(t=Math.floor(t/r)*r,i=Math.floor(i/s)*s):(t=Math.round(t/r)*r,i=Math.round(i/s)*s),a||(t=t>r?t:r,i=i>s?i:s),[t,i]}static find_graph_node(e,t){for(let i of e.Nodes)if(i.Id==t)return i;return null}static find_graph_edge(e,t,i){for(let a of e.Edges)if(a.Left==t&&a.Right==i)return a;return null}static async on_graph_node_resized(e,t,i,a,n){if(!0!==n.autolayout){var r=obj(str(a)),s=i.rect(),_=s.width/e.rect().width*100,l=s.height/e.rect().height*100,[_,l]=p.snap_to_grid(t,_,l,!1);if(r.width=_,r.height=l,null!=n.on_node_resized){let t=await n.on_node_resized(r);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}}static async on_graph_node_moved(e,t,i,a,n,r,s){if(!0!==p.ignore_moving_node){if(!0!==n.autolayout){var _=obj(str(a)),{ele_x:l,ele_y:o,ele_w:d,ele_h:c,drag_x:u,drag_y:h}=s,f=r.clientX,g=r.clientY;if(f-=u-l,g-=h-o,f-=e.rect().x,g-=e.rect().y,f=f/e.rect().width*100,g=g/e.rect().height*100,[f,g]=p.snap_to_grid(t,f,g,!0),_.x=f,_.y=g,null!=n.on_node_moved){let t=await n.on_node_moved(_);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}}else p.ignore_moving_node=!1}static async on_graph_edge_edit(e,t,i,a,n,r,s,_){var l=obj(_);if(null!=l&&"graph-node"==l.Type){p.ignore_moving_node=!0;var o=l.Id,d=a.Id,c=p.find_graph_node(t,o),u=p.find_graph_node(t,d),h=p.find_graph_edge(t,d,o);if(d!=o)if(null!=h){var f=await p.select_with_btns(__h("EDIT_EDGE_OR_DELETE_"),{edit:__h("IC_EDIT_EDGE"),del:__h("IC_DELETE_EDGE")},{Item_Width:"50%"});if(null!=f)if("edit"==f){let i=await p.prompt(__h("ENTER_NEW_EDGE_NAME_"),h.Caption);if(null==i)return;if(h.Caption=i,null!=n.on_edge_edited){let t=await n.on_edge_edited(h);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}else if(null!=n.on_edge_deleted){let t=await n.on_edge_deleted(h);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}else{if("yes"!=await p.confirm(__h("CREATE_EDGE_FROM")+` <b>${esch(u.Name)}</b> to <b>${esch(c.Name)}</b>?`))return;let i=await p.prompt(__h("ENTER_EDGE_NAME_"));if(null==i)return;if(h={Left:d,Right:o,Caption:i,Color:"silver"},null!=n.on_edge_created){let t=await n.on_edge_created(h);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}}}static on_graph_node_ctxmenu(e,t,i,a,n,r){async function s(){var i=await p.prompt(__h("ENTER_NEW_NAME_"),a.Name);if(null!=i&&0!=i.length){var r=obj(str(a));if(r.Name=i,null!=n.on_node_renamed){let t=await n.on_node_renamed(r);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}}async function _(){if("yes"==await p.confirm(__h("SURE_TO_DELETE_THAT_NODE_"))){var i=obj(str(a));if(null!=n.on_node_deleted){let t=await n.on_node_deleted(i);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}}if(null==n.Node_Menu&&(n.Node_Menu=[]),0==n.Node_Menu.length)var l=[[__h("IC_EDIT_NAME"),s],["---sep---"],[__h("IC_DELETE_NODE"),_]];else l=[[__h("IC_EDIT_NAME"),s],["---sep---"]].concat(n.Node_Menu).concat([["---sep---"],[__h("IC_DELETE_NODE"),_]]);p.show_menu(r,null,l)}static async on_graph_node_clicked(e,t,i,a,n,r){if(null!=n.on_node_clicked){let t=await n.on_node_clicked(a);p.show_grouped_graph(e,t,n)}else p.show_grouped_graph(e,t,n)}static add_depth(e,t,i){t.depth=i;for(let a of t.Nexts){if(null!=a.depth&&a.depth>=0)continue;let n=p.find_graph_edge(e,t.Id,a.Id);a.Inbound=n.Caption.toLowerCase(),p.add_depth(e,a,i+1)}}static async show_graph_menu(e,t,i,a){if("svg"==e.target.tagName.toLowerCase()){var n=[[__h("IC_CREATE_NODE"),async function(){var n=await p.prompt(__h("ENTER_NEW_NODE_NAME_"));if(null!=n&&0!=n.length){var r=t.rect(),s=r.width,_=r.height,l=(e.clientX-r.x)/s*100,o=(e.clientY-r.y)/_*100,d=100/i.grid_size_w,c=100/i.grid_size_h;[l,o]=p.snap_to_grid(i,l,o,!0,!0),[d,c]=p.snap_to_grid(i,d,c,!0,!0);var u={Name:n,x:l,y:o,width:d,height:c};if(null!=a.on_node_created){let e=await a.on_node_created(u);p.show_grouped_graph(t,e,a)}else p.show_grouped_graph(t,i,a)}}],[__h("IC_LINK_EXISTING_NODE"),async function(){var n=t.rect(),r=n.width,s=n.height,_=(e.clientX-n.x)/r*100,l=(e.clientY-n.y)/s*100,o=100/i.grid_size_w,d=100/i.grid_size_h;[_,l]=p.snap_to_grid(i,_,l,!0,!0),[o,d]=p.snap_to_grid(i,o,d,!0,!0);var c={x:_,y:l,width:o,height:d};if(null!=a.on_node_linking){let e=await a.on_node_linking(c);p.show_grouped_graph(t,e,a)}else p.show_grouped_graph(t,i,a)}],["---sep---"],[__h("IC_USE_CUSTOM_LAYOUT"),async function(){a.autolayout=!1,p.show_grouped_graph(t,t.Orig_Data,a)}],[__h("IC_USE_AUTO_LAYOUT"),async function(){null!=a.Autofrom&&null!=a.autopadx&&null!=a.autopady?(a.autolayout=!0,p.show_grouped_graph(t,t.Orig_Data,a)):f.notif("No options to switch to auto")}]];p.show_menu(e,null,n)}}static show_grouped_graph(e,t,i={}){var a=e.rect(),n=a.width,r=a.height,s=n/t.grid_size_w,_=r/t.grid_size_h;e.innerHTML="",e.Orig_Data=t,t=clone(t);var l={};for(let e of t.Nodes)l[e.Id]=e;if(!0===i.autolayout){for(let e of t.Nodes)e.depth=-1,e.Nexts=[];for(let e of t.Edges)l[e.Left].Nexts.push(e.Right);for(let e of t.Nodes){e.Nexts=[...new Set(e.Nexts)];for(let t=0;t<e.Nexts.length;t++)e.Nexts[t]=l[e.Nexts[t]]}p.add_depth(t,l[i.Autofrom],0);let e=-1,a=100/t.grid_size_w,n=100/t.grid_size_h;for(let i of t.Nodes)i.width=a,i.height=n,i.depth>e&&(e=i.depth);let r=[];for(let i=0;i<=e;i++){r.push([]);for(let e of t.Nodes)e.depth==i&&r[i].push(e)}let s=t.Nodes.filter((e=>-1==e.depth)),_=i.autopadx*a,o=i.autopadx*a,d=i.autopady*n;s.sort(((e,t)=>e.Name<t.Name?-1:e.Name>t.Name?1:0)),r.push(s);for(let e of r){e.sort(((e,t)=>e.Inbound<t.Inbound?-1:e.Inbound>t.Inbound?1:e.Name<t.Name?-1:e.Name>t.Name?1:0));for(let t of e)t.x=o,t.y=d,o+=a,o>=100&&(o=_,d+=n);d+=o==_?n:2*n,o=_}}for(let e of t.Nodes)e.Name=e.Name.trim();for(let e of t.Edges)e.Caption=e.Caption.trim();for(let i=0;i<t.grid_size_h-1;i++)p.add_line(e,0,(i+1)*_,n,(i+1)*_,"#eee",1);for(let i=0;i<t.grid_size_w-1;i++)p.add_line(e,(i+1)*s,0,(i+1)*s,r,"#eee",1);for(let a of t.Nodes){let s=a.x/100*n,_=a.y/100*r,l=a.width/100*n-2,o=a.height/100*r-2,d=new_ele("span");d.css({display:"inline-block",position:"absolute",left:s+"px",top:_+"px",width:l+"px",height:o+"px",border:"1px solid silver",borderRadius:".5rem",paddingLeft:"5px",backgroundColor:"white",cursor:"pointer",userSelect:"none",overflow:"hidden"}),d.attr("draggable","true"),d.attr("data-id",a.Id),d.classList.add("hover-light"),d.innerHTML=a.Name,e.appendChild(d),p.make_resizable(d,(n=>{p.on_graph_node_resized(e,t,n,a,i)})),p.set_ondragstart(d,{Type:"graph-node",Id:a.Id}),p.set_ondrop(d,((n,r,s)=>{p.on_graph_edge_edit(e,t,d,a,i,n,r,s)})),d.on("contextmenu",(n=>{p.on_graph_node_ctxmenu(e,t,d,a,i,n)})),d.on("click",(n=>{p.on_graph_node_clicked(e,t,d,a,i,n)}))}e.Data=t;var o=(t,a,n)=>{var r=obj(n);if(null!=r&&"graph-node"==r.Type){var s=e.Data,_=e$(e,`*[data-id="${r.Id}"]`),l=s.Nodes.filter((e=>e.Id==r.Id))[0];p.on_graph_node_moved(e,s,_,l,i,t,r)}};null==e.graph_drop_func&&(p.set_ondrop(e,o),e.graph_drop_func=o),null==e.graph_menu_set&&(e.on("contextmenu",(a=>{this.show_graph_menu(a,e,t,i)})),e.graph_menu_set=!0);var d={};for(let e of t.Edges){let t=e.Caption.trim().toLowerCase();0==t.length&&(t=rand_id());let i=`${e.Left}#/#${t}`;null==d[i]&&(d[i]={Left:clone(l[e.Left]),Caption:e.Caption,Rights:[],Color:e.Color}),d[i].Rights.push(clone(l[e.Right]))}for(let e in d){let t=d[e];t.x=Number.MAX_SAFE_INTEGER,t.y=Number.MAX_SAFE_INTEGER;for(let e of t.Rights)e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y)}for(let e in d){let t=d[e];t.width=-Number.MAX_SAFE_INTEGER,t.height=-Number.MAX_SAFE_INTEGER;for(let e of t.Rights)e.x+e.width-t.x>t.width&&(t.width=e.x+e.width-t.x),e.y+e.height-t.y>t.height&&(t.height=e.y+e.height-t.y)}for(let e in d){let t=d[e];t.Left.x=t.Left.x/100*n,t.Left.y=t.Left.y/100*r,t.Left.width=t.Left.width/100*n,t.Left.height=t.Left.height/100*r,t.x=t.x/100*n,t.y=t.y/100*r,t.width=t.width/100*n,t.height=t.height/100*r}for(let t in d){let a,n=d[t],r=n.Color||"silver",s=n.Caption||"",_=n.Left,l=n;!0===i.autolayout?p.add_arrow_box2box(e,_,l,r,s,a=!0):p.add_arrow_box2box(e,_,l,r,s),p.add_rectangle(e,n.x,n.y,n.x+n.width,n.y+n.height,"silver")}}_____Tree_____(){}static treeitem_html(e,t,i,a){if(null==e.Data_Id&&loge("ui.js/treeitem_html: Missing Data_Id field in",e),i)if(e.depth>a){var n="hidden";p.Treeitem_Displays[t][e.Data_Id]=!1}else n="",p.Treeitem_Displays[t][e.Data_Id]=!0;else n=p.Treeitem_Displays[t][e.Data_Id]?"":"hidden";var r,s,_=`<div data-id='${e.Data_Id}' class="wp-tree-item"\n        depth="${e.depth}" pa-data-id="${e.Pa_Data_Id}" tree-id="${t}" ${n}\n        is-section="${e.is_section}" style="white-space:nowrap;">`;_+=`<div class="wp-tree-dropbefore" tree-id="${t}" pa-data-id="${e.Pa_Data_Id}" \n                data-id="${e.Data_Id}" is-section="${e.is_section}" \n                style="height:5px; line-height:5px;">&nbsp;</div>`,_+='<div style="height:calc(var(--line-h) - 5px); line-height:calc(var(--line-h) - 5px);">',r=e.hide_root?e.depth-1:e.depth;for(let e=0;e<r;e++)_+=`<span class="wp-tree-indent" depth="${e}" \n            style="display:inline-flex; width:var(--line-h); transform:scale(1,2);\n            justify-content:center; align-items:center; pointer-events:none;">&nbsp;</span>`;if(s=null!=e.Icon?e.Icon:"🔷",_+=`<span data-id="${e.Data_Id}" title="${__a("CLICK_ICON_TO_TOGGLE_CHILDREN")}" \n        class="wp-treeitem-icon" tree-id="${t}" is-section="${e.is_section}"\n        style="cursor:pointer; user-select:none;">${s}</span>`,e.is_section)var l="";else l='draggable="true"';return null!=e.Children&&e.Children.length>0?_+=`<span class="wp-tree-text" tree-id="${t}" data-id="${e.Data_Id}" \n            pa-data-id="${e.Pa_Data_Id}" ${l} is-section="${e.is_section}"\n            style="cursor:pointer; user-select:none;"\n            ><b>${e.Text}</b></span>`:_+=`<span class="wp-tree-text" tree-id="${t}" data-id="${e.Data_Id}" \n            pa-data-id="${e.Pa_Data_Id}" ${l} is-section="${e.is_section}"\n            style="cursor:pointer; user-select:none;"\n            >${e.Text}</span>`,1==e.is_section||(_+=`<span class="wp-tree-menubtn" tree-id="${t}" data-id="${e.Data_Id}" \n            style="cursor:pointer;">&nbsp;...&nbsp;</span>`),_+"</div></div>"}static add_sibling_lines(e){var t=e$$(e,".wp-tree-item");for(let e of t){let t,i=parseInt(e.attr("depth")),a=Number.MAX_SAFE_INTEGER,n=e.previousElementSibling;if(null!=n&&(a=parseInt(n.attr("depth")),t="true"==n.attr("is-section")),a==i-1||t){let t=[],a=e;for(;null!=a.nextElementSibling&&!(parseInt(a.nextElementSibling.attr("depth"))<i)&&("true"!=a.nextElementSibling.attr("is-section")||parseInt(a.nextElementSibling.attr("depth"))!=i);)t.push(a.nextElementSibling),a=a.nextElementSibling;let n=t.length;for(n>0&&1==t[n-1].attr("is-section")&&parseInt(t[n-1].attr("depth"))==i&&(t=t.slice(0,n-1));t.length>0;){let e=t.length,a=parseInt(t[e-1].attr("depth"));if(a==i)break;a>i&&(t=t.slice(0,e-1))}for(let e of t){let t=e$(e,`span[depth="${i}"]`);null!=t&&(t.innerHTML="︱")}}}}static tree_toggle_child_items(e,t){for(var i=e.target.attr("data-id"),a=e$(t,`.wp-tree-item[data-id="${i}"]`),n=a.attr("tree-id"),r=[],s=a,_=parseInt(a.attr("depth"));null!=s.nextElementSibling&&!(parseInt(s.nextElementSibling.attr("depth"))<=_);)r.push(s.nextElementSibling),s=s.nextElementSibling;if(0!=r.length){if(r[0].is_shown())var l=!1;else l=!0;for(let e of r)e.hide(),p.Treeitem_Displays[n][e.attr("data-id")]=!1;if(1==l)for(let e of r)parseInt(e.attr("depth"))==_+1&&(e.disp(l),p.Treeitem_Displays[n][e.attr("data-id")]=l)}}static is_valid_drag(e,t,i){if(t==i)return!1;for(var a=e$(e,`.wp-tree-item[data-id="${i}"]`),n=0;;){if(n>100)return!1;let i=a.attr("pa-data-id");if(null==i)break;let r=e$(e,`.wp-tree-item[data-id="${i}"]`);if(null==r)break;if(i==t)return!1;a=r,n++}return!0}static tree_item_up_from(e){for(;null!=e&&!e.classList.contains("wp-tree-item");)e=e.parentElement;return e}static get_sibling_weights(e,t){var i=d$(`.wp-tree-item[data-id="${e}"]`).attr("pa-data-id"),n=d$$(`.wp-tree-item[pa-data-id="${i}"]`);n=n.filter((e=>"true"!=e.attr("is-section")));var r=0,s=0;for(let t=0;t<n.length;t++)if(n[t].attr("data-id")==e){r=t;break}for(let e=0;e<n.length;e++)if(n[e].attr("data-id")==t){s=e;break}a.A.move(n,r,s);var _={};for(let e=0;e<n.length;e++)_[n[e].attr("data-id")]=e;return _}static show_sectioned_tree(e,t,i,a={}){null==a.display_upto_level?a.display_upto_level=1:"max"==a.display_upto_level&&(a.display_upto_level=Number.MAX_SAFE_INTEGER);var n=[];!function e(t,i,n,r){i.depth=n,null==i.Children&&(i.Children=[]),!0===a.hide_root?i.hide_root=!0:i.hide_root=!1,i.Data_Id,t.push(i);var s="az";null!=a.Sort&&(s=a.Sort),"az"==s?i.Children.sort(((e,t)=>h(e,t,"Text"))):"za"==s?i.Children.sort(((e,t)=>function(e,t,i){return e[i]>t[i]?-1:e[i]<t[i]?1:0}(e,t,"Text"))):i.Children.sort(((e,t)=>h(e,t,"weight")));var _=[];for(let e of i.Children)_.push(e.Section);(_=[...new Set(_)]).sort();var l={};for(let e of _){l[e]=[];for(let t of i.Children)t.Section!=e||0!=t.is_section&&null!=t.is_section||l[e].push(t)}var o=[];for(let e of _)if(null!=e){o.push({Icon:"➖",Text:"<i>"+e+"</i>:",is_section:!0,Section:e,Data_Id:r+"/"+e});for(let t of l[e])o.push(t)}for(let e of _)if(null==e){o.push({Icon:"➖",Text:"<i>"+e+"</i>:",is_section:!0,Section:e,Data_Id:r+"/"+e});for(let t of l[e])o.push(t)}if(0==_.length);else if(1==_.length&&null==_[0])i.Children=o.filter((e=>null!=e.Section||null==e.Section&&null==e.is_section));else if(_.filter((e=>null!=e)).length==_.length)i.Children=o;else{for(let e=0;e<o.length;e++)o[e].is_section&&null==o[e].Section&&(o[e].Text=`<i>${__h("NO_SECTION")}</i>:`);i.Children=o}for(let a of i.Children)a.Pa_Data_Id=i.Data_Id,e(t,a,n+1,r+"/"+i.Data_Id)}(n,t,0,""),!0===a.hide_root&&(n=n.slice(1));var r=!1;null==p.Treeitem_Displays[e]&&(p.Treeitem_Displays[e]={},r=!0);var s=n.map((t=>p.treeitem_html(t,e,r,a.display_upto_level)));i.innerHTML=s.join(""),p.add_sibling_lines(i);var _=e$$(i,".wp-treeitem-icon");for(let e of _)e.on("click",(e=>{p.tree_toggle_child_items(e,i)}));_=(_=e$$(i,".wp-tree-text")).filter((e=>"true"!=e.attr("is-section")));for(let e of _)e.on("click",(t=>{a.on_click_item(t,e.attr("tree-id"),e.attr("data-id"))}));_=e$$(i,".wp-tree-menubtn");for(let e of _)e.on("click",(t=>{p.show_menu(t,e,[[__h("IC_ADD_CHILD"),async(e,t)=>{var n=e.target.attr("tree-id"),r=await a.on_add_child(e,n,t);p.show_sectioned_tree(n,r,i,a)}],[__h("IC_RENAME"),async(e,t)=>{var n=e.target.attr("tree-id"),r=await a.on_rename(e,n,t);p.show_sectioned_tree(n,r,i,a)}],[__h("IC_DELETE"),async(e,t)=>{var n=e.target.attr("tree-id"),r=await a.on_delete(e,n,t);p.show_sectioned_tree(n,r,i,a)}]])}));_=(_=e$$(i,".wp-tree-text")).filter((e=>"true"!=e.attr("is-section")));for(let t of _)p.set_ondragstart(t,{Tree_Id:e,Data_Id:t.attr("data-id"),Pa_Data_Id:t.attr("pa-data-id")}),p.set_ondrop(t,(async(t,n,r)=>{var s=obj(r);if(null!=s){var _=p.tree_item_up_from(t.target);if(p.is_valid_drag(i,s.Data_Id,_.attr("data-id"))){var l=await a.on_drop_into(t,e,s.Data_Id,_.attr("data-id"));p.show_sectioned_tree(e,l,i,a)}else f.alert(__h("CANT_DRAG_INSIDE"))}}));_=(_=e$$(i,".wp-tree-dropbefore")).filter((e=>"true"!=e.attr("is-section")));for(let t of _)p.set_ondrop(t,(async(t,n,r)=>{var s=obj(r);if(null!=s){var _=p.tree_item_up_from(t.target);if(p.is_valid_drag(i,s.Data_Id,_.attr("data-id"))){var l=!1;if(d$(`.wp-tree-item[data-id="${s.Data_Id}"]`).attr("pa-data-id")==_.attr("pa-data-id")&&(l=!0),l)o=p.get_sibling_weights(s.Data_Id,_.attr("data-id"));else var o={};var d=await a.on_drop_before(t,e,s.Data_Id,_.attr("data-id"),l,o);p.show_sectioned_tree(e,d,i,a)}else f.alert(__h("CANT_DRAG_INSIDE"))}}))}_____MENUS_____(){}static find_ancestor(e,t){if(e.classList.contains(t))return e;for(;null!=e.parentElement;){if(e.parentElement.classList.contains(t))return e.parentElement;e=e.parentElement}return null}static show_menu(e,t,i,a=!1){if(0==a)for(let e of d$$(".ctx-menu"))e.remove();for(let e=0;e<i.length;e++)i[e]instanceof Array&&(i[e]={Text:i[e][0],callback:i[e][1],Children:i[e][2]},null!=i[e].Children&&i[e].Children.length>0?i[e].Marker='<span style="float:right;">»&nbsp;</span>':i[e].Marker="");if(null!=t)var n=(c=t.getBoundingClientRect()).x,r=c.y,s=c.height;else e.preventDefault(),n=e.clientX,r=e.clientY,s=0;window.innerWidth;var _,l=window.innerHeight;_=r<l/2?"below":"above",!0===a&&(n+=c.width+10,"below"==_?r-=c.height+10:r+=c.height+10);var o=new_ele("div");o.classList.add("ctx-menu"),o.css({position:"fixed",left:n+"px",backgroundColor:"#eee",border:"1px solid silver",borderRadius:"5px",padding:"10px"});var d="";"above"==_?o.css({bottom:l-r+"px"}):o.css({top:r+s+"px"});for(let e=0;e<i.length;e++){let t=i[e];"---sep---"!=t.Text?d+=`<div idx="${e}" class="ctx-menu-item" style="cursor:pointer;\n                        user-select:none; white-space:nowrap;"\n                    >${esch(t.Text)+t.Marker}\n                </div>`:d+='<div style="user-select:none;"><hr></div>'}o.innerHTML=d;var c,u=e$$(o,".ctx-menu-item");for(let e of u)e.Childitems=i[parseInt(e.attr("idx"))].Children;d$("body").appendChild(o),(c=o.getBoundingClientRect()).x+c.width>window.innerWidth&&(window.innerWidth,c.x,o.css({left:window.innerWidth-c.width+"px"}));for(let t of u)t.on("click",(a=>{if(a.target.Childitems)p.show_menu(a,t,a.target.Childitems,!0);else{var n=parseInt(a.target.attr("idx")),r=i[n].callback;o.remove(),p.menu_shown=!1,"function"==typeof r?r(e,e.target.attr("data-id")):logw(`ui.js/show_menu: Method for '${i[n].Text}' not found:`,r)}}));function h(e){null==p.find_ancestor(e.target,"ctx-menu")&&(o.remove(),p.menu_shown=!1,d$("body").removeEventListener("click",h))}setTimeout((()=>{d$("body").on("click",h)}),10),p.menu_shown=!0}static close_menu(){for(let e of d$$(".ctx-menu"))e.remove();p.menu_shown=!1}_____MISCS_____(){}static async show_err(e){await p.alert("Error: "+e)}static async alert_noauth(){p.alert(__h("PLEASE_LOG_IN_TO_SAVE"))}_____DRAGDROP_____(){}static set_ondragstart(e,t){e.on("dragstart",(e=>{var i=e.target.rect(),a=e.clientX,n=e.clientY;t={...t,ele_x:i.x,ele_y:i.y,ele_w:i.width,ele_h:i.height,drag_x:a,drag_y:n},e.dataTransfer.setData("Text",str(t))}))}static set_ondrop(e,t){e.on("dragover",(e=>{e.preventDefault()})),e.on("dragenter",(t=>{e.attr("computed-bg",a.A.get_style(e,"backgroundColor")),e.style.backgroundColor="yellow"})),e.on("dragleave",(t=>{var i=e.attr("computed-bg");e.style.backgroundColor=i})),e.on("drop",(i=>{var a=e.attr("computed-bg");e.style.backgroundColor=a;var n=i.dataTransfer.getData("URL"),r=i.dataTransfer.getData("text");null!=n&0==n.trim().length&&(n=null),null!=r&0==r.trim().length&&(r=null),i.preventDefault(),t(i,n,r)}))}_____RESIZER_____(){}static make_resizable(e,t){var i=e.parentElement.rect(),a=e.rect();a.x,i.x,a.y,i.y;i.width,i.height,e.css({resize:"both",overflow:"hidden"});var n=!1,r=0;new ResizeObserver((e=>{0!=r?n=!0:r++})).observe(e),e.on("mouseup",(i=>{!0===n&&(n=!1,t(e))}))}_____CORE_____(){}static init(){n.A.init_com("color-picker",l,'<span for="C: let C of Colors">\n    <span class="wp-color-cell" color="{{this}}"\n    style="background-color:{{this}}">&nbsp;</span>\n</span>\n\x3c!-- EOF --\x3e',o.A),n.A.init_com("richtext-edit",c,'<div>{{Msg_Html}}</div>\n<div>\n    <button class="wp-rt-btn" title="[[ENTER_TWICE_TO_GET_OUT_OF_DOT]]"\n        onclick="method:insert_dot">&nbsp;•&nbsp;</button>\n    <button class="wp-rt-btn" title="[[ENTER_TWICE_TO_GET_OUT_OF_DOT]]"\n        onclick="method:insert_num">&nbsp;1.&nbsp;</button>\n    <button class="wp-rt-btn" onclick="method:insert_emptytick">◻</button>\n    <button class="wp-rt-btn" onclick="method:insert_tick">✓</button>\n</div>\n<div class="richtext wp-richtext" contenteditable\n    onkeydown="method:on_edit_key">{{Default}}</div>\n\x3c!-- EOF --\x3e',u.A)}}window.ui=f;const p=f,g=f},601:e=>{e.exports=function(e){return e[1]}},620:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(842);function OX_INDENT_Result(){}function _____PROTOTYPE_____(){}function _____CLASS_____(){}Element.prototype.attr=function(e,t){if(null==t)return this.getAttribute(e);this.setAttribute(e,t)},Element.prototype.attrs=function(){return this.getAttributeNames()},Element.prototype.attrs_set=function(e){for(let t in e)this.attr(t,e[t])},Element.prototype.css=function(e){for(let t in e)this.style[t]=e[t]},Element.prototype.html=function(e){if(null==e)return this.innerHTML;this.innerHTML=e},Element.prototype.clear=function(){this.innerHTML=""},Element.prototype.rect=function(){return this.getBoundingClientRect()},Element.prototype.show=function(){this.removeAttribute("hidden")},Element.prototype.hide=function(){this.setAttribute("hidden","true")},Element.prototype.disp=function(e){e?this.show():this.hide()},Element.prototype.is_shown=function(){return null==this.getAttribute("hidden")},Element.prototype.on=function(e,t){this.addEventListener(e,t)},Element.prototype.to_top=function(){this.scrollBy(0,-Number.MAX_SAFE_INTEGER)},Element.prototype.to_bottom=function(){this.scrollBy(0,Number.MAX_SAFE_INTEGER)};class ut{static Named_Locks={};_____JS_LANG_____(){}static new_lock(){var e;return[new Promise(((t,i)=>{e=t})),e]}static new_named_lock(e){let[t,i]=new_lock();return thisclass.Named_Locks[e]=t,function(){i(),delete thisclass.Named_Locks[e]}}static locked(e){return null!=thisclass.Named_Locks[e]}static lock(e){return thisclass.Named_Locks[e]}static eval_ctx(Jscode,Data){var Result=function(Jscode){return eval(Jscode)}.call(Data,Jscode);return Result}_____UTILS_____(){}static ls_empty(e){return null==localStorage[e]||0==localStorage[e].trim().length}static d$(e){return document.querySelector(e)}static d$$(e){return[...document.querySelectorAll(e)]}static e$(e,t){return e.querySelector(":scope "+t)}static e$$(e,t){return[...e.querySelectorAll(":scope "+t)]}static get_style(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):null}static get_borders(e){var t=parseFloat(e.style.borderLeft.toString().replace(/px.+$/,"").trim()),i=parseFloat(e.style.borderRight.toString().replace(/px.+$/,"").trim()),a=parseFloat(e.style.borderTop.toString().replace(/px.+$/,"").trim()),n=parseFloat(e.style.borderBottom.toString().replace(/px.+$/,"").trim());return{left:t=isNaN(t)?0:t,right:i=isNaN(i)?0:i,top:a=isNaN(a)?0:a,bottom:n=isNaN(n)?0:n}}static new_ele(e,t=null){var i=document.createElement(e);return null!=t&&(i.innerHTML=t),i}static new_ele_svg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}static escape_html(e){return null==e?null:e.replaceAll("<","&lt;").replaceAll(">","&gt;")}static escape_attr(e){return null==e?null:e.replaceAll("'","&apos;").replaceAll('"',"&quot;").replaceAll("\n"," ")}static tidy_up(e){return e.trim().replace(/[\s]{2,}/g," ")}static move(e,t,i){if(t!=i)return t>i?e.splice(i,0,e.splice(t,1)[0]):e.splice(i-1,0,e.splice(t,1)[0]),e}static find_ancestor_with_id(e,t){if(e.id==t)return e;for(;null!=e&&!e.id==t;)e=e.parentElement;return e}static find_ancestor_with_class(e,t){if(e.classList.contains(t))return e;for(;null!=e&&!e.classList.contains(t);)e=e.parentElement;return e}static url_params(e=null){null==e&&(e=location.search);var t=new URLSearchParams(e),i={};for(let e of[...t.keys()])i[e]=t.get(e);return i}static get_url_param(e){return thisclass.url_params()[e]}_____Clipboard_____(){}static copy_to_clipboard(e){navigator.clipboard.writeText(e)}_____Utils_Miscs_____(){}static email_is_valid(e){var t=new_ele("input");return t.attr("type","email"),t.value=e,t.checkValidity()}static get_page_topbottom(e,t){return null==e._Paging&&(e._Paging={}),null==e._Paging[t]&&(e._Paging[t]={}),{Pagetop:e._Paging[t].Pagetop,Pagebottom:e._Paging[t].Pagebottom}}static set_page_topbottom(e,t,i,a){null==e._Paging&&(e._Paging={}),null==e._Paging[t]&&(e._Paging[t]={}),e._Paging[t].Pagetop=i,e._Paging[t].Pagebottom=a}_____TEMPLATING_____(){}_____Legacy_____(){}static v_(e){return e}static if_(e){return e?"":"hidden"}static for_(e,t){var i="";for(let a of e)i+=thisclass.eval_ctx("`"+t+"`",a);return i}static for_key_(e,t){var i="";for(let a in e)i+=thisclass.eval_ctx("`"+t+"`",{Key:a,Val:e[a]});return i}static com_(e,t){return _cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__.A.render_com(e,t,null,!1)}static call_(e,t){for(var i=e.target;null!=i;){if(null!=i.attr("screen-name")||null!=i.attr("com-name"))return null==i.Controller?void loge("No controller for",i):"function"!=typeof i.Controller[t]?void loge(`No such method '${t}', event:`,e):void i.Controller[t](e);i=i.parentElement}loge(`No such method '${t}', event:`,e)}_____New_____(){}static get_live_menu_item(e,t){if(t[0]=__h(t[0]),t[1]=null!=e[t[1]]?e[t[1]]:t[1],null!=t[2])for(let i=0;i<t[2].length;i++)t[2][i]=thisclass.get_live_menu_item(e,t[2][i]);return t}static get_live_menu(e,t){var i=obj(str(t));for(let t=0;t<i.length;t++)i[t]=thisclass.get_live_menu_item(e,i[t]);return i}static show_menu(e,t){e.preventDefault();for(var i=e.target;null!=i;){if(null!=i.attr("screen-name")||null!=i.attr("com-name"))return null==_cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__.A.get_menu(t)?void loge(`No such menu '${t}', event:`,e):void(2==e.button?ui.show_menu(e,null,thisclass.get_live_menu(i.Controller,_cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__.A.get_menu(t))):ui.show_menu(e,e.target,thisclass.get_live_menu(i.Controller,_cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__.A.get_menu(t))));i=i.parentElement}loge(`No such menu '${t}', event:`,e)}static get_ui_event(){return window._Ui_Event}static parse_values(e,t,i="html"){var a;if(null!=(a=e.match(/({{[^{]+}})/g))&&a.length>0){a=[...new Set(a)];for(let n of a){let a=n.replace("{{","").replace("}}","").trim();if("this"==a)e=e.replaceAll(n,t);else{let r;if(0!=a.indexOf("js:")){let e=a.split(".");r=t;for(let t of e)r=r[t]}else{let e=a.replace("js:","");e=`var {${keys(t).join(",")}}=this;`+e;try{r=ut.eval_ctx(e,t)}catch(t){loge("ut.js/parse_values:",t),loge("Code:",e)}}null!=r?("boolean"==typeof r&&(r=new Boolean(r)),"number"==typeof r&&(r=new Number(r)),r=r.toString()):r="null",e="html"==i||"key"==i?e.replaceAll(n,esch(r)):e.replaceAll(n,esca(r))}}}if(null==(a=e.match(/(\[\[[0-9A-Za-z_\s.]+\]\])/g))||0==a.length)return e;a=[...new Set(a)];for(let t of a){let a=t.replace("[[","").replace("]]","").trim();e="html"==i||"key"==i?e.replaceAll(t,__h(a)):"attr"==i?e.replaceAll(t,__a(a)):e.replaceAll(t,__(a))}return e}static parse_values_in_attrs(e,t){const i=thisclass.parse_values;for(let a of e.attrs())e.attr(a,i(e.attr(a),t,"attr"))}static parse_attr(e,t,i){thisclass.escape_html;const a=thisclass.escape_attr,n=thisclass.parse_values;let r,s;if(r=t.indexOf("{{")>=0?n(t,i,"html"):t,s=e.attr(t),null==s||0==s.trim().length)return` ${r}`;if(0==s.trim().indexOf("screen:"))return` ${r}="cvm_.render_screen('${s.replace("screen:","").trim()}',{})"`;if(0==s.trim().indexOf("method:"))return` ${r}="window._Ui_Event=event; call(event,'${s.replace("method:","").trim()}')"`;if(0==s.trim().indexOf("menu:"))return` ${r}="window._Ui_Event=event; show_menu_(event,'${s.replace("menu:","").trim()}')"`;if(0==s.trim().indexOf("dialog:")){let e=s.replace("dialog:","").trim();if(-1==e.indexOf("/"))return` ${r}="window._Ui_Event=event; ui.dialog(__a('DIALOG'),'${e}',{},()=>{ ui.no_dlg_buttons(); })"`;{let t=e.split("/");return e=t[0],"ok"==t[1]?` ${r}="window._Ui_Event=event; ui.dialog(__a('DIALOG'),'${e}',{},()=>{})"`:(loge(`Invalid dialog option in: ${e}/${t[1]}`),` ${r}="window._Ui_Event=event; ui.dialog(__a('DIALOG'),'${e}',{},()=>{ ui.no_dlg_buttons(); })"`)}}return` ${r}="${a(n(s,i,"attr"))}"`}static parse_if(e,t){var i,a=Object.keys(t),n="const {";for(let e of a)n+=e+",";n+="} = this;\n",n+=e+";";try{i=thisclass.eval_ctx(n,t)}catch(e){loge("Error:",e),loge("Code:",n),i=!0}return 1==i?` if="${e}"`:` if="${e}" hidden`}static parse_for(e,t){var i=e.attr("for"),a=i.split(":"),n=a[0].trim();i=a.slice(1).join(":"),null!=e.attr("id")&&e.attr("id",e.attr("id")+rand_id()),null!=e.attr("name")&&e.attr("name",e.attr("name")+rand_id()),t._Ele=e;var r,s=Object.keys(t),_="const {";for(let e of s)_+=e+",";_+="} = this;\n",_+='var Html = "";\n',_+=`var i=0;\nfor (${i.trim()}) {\n   if (typeof ${n}=="boolean") ${n}=new Boolean(${n});\n   if (typeof ${n}=="number")  ${n}=new Number(${n});\n   if (typeof ${n}=="string")  ${n}=new String(${n});\n   ${n}._Con = _Con;\n   ${n}._index = i;\n   ${n}._Varname = "${n}";\n   ${n}._Pa = this;\n   Html += ut.parse_ele(_Ele,${n},1);\n   i++;}\nHtml;`;try{r=thisclass.eval_ctx(_,t)}catch(e){loge("Error:",e),loge("Code:",_),r="<div>"+e.toString()+"</div>"}return r}static parse_forkey(e,t){var i=e.attr("for-key"),a=i.split(":"),n=a[0].trim();i=a.slice(1).join(":");var r=n.split("/")[1];n=n.split("/")[0],null!=e.attr("id")&&e.attr("id",e.attr("id")+rand_id()),null!=e.attr("name")&&e.attr("name",e.attr("name")+rand_id()),t._Ele=e;var s,_=Object.keys(t),l="const {";for(let e of _)l+=e+",";l+="} = this;\n",l+='var Html = "";\n',l+=`for (${i.trim()}) {\n   Html += ut.parse_ele(_Ele,\n      {Key:${n}, Val:${r}[${n}]}\n   ,1);\n}\nHtml;`;try{s=thisclass.eval_ctx(l,t)}catch(e){loge("Error:",e),loge("Code:",l),s="<div>"+e.toString()+"</div>"}return s}static parse_com(e,t){var i,a,n=e.attr("com");if(-1==n.indexOf("/"))i=n,a=t;else{i=n.split("/")[0];let e=n.split("/")[1];if(e.indexOf("{")>=0)try{a=JSON.parse(e)}catch{loge(`Bad component JSON data (${i}):`,e),a={}}else null==t[e]?(loge(`Bad field key (${i}):`,e),a={}):a=t[e]}return _cvm_cvm_js__WEBPACK_IMPORTED_MODULE_0__.A.render_com(i,a,null,!1)}static parse_ele(e,t,i){thisclass.escape_html,thisclass.escape_attr;const a=thisclass.parse_values;var n="";if(i>0){n+="<"+e.tagName;for(let i of e.attrs())n+="if"==i?thisclass.parse_if(e.attr("if"),t):thisclass.parse_attr(e,i,t);n+=">"}for(let r of e.childNodes)if(r.nodeType==Node.TEXT_NODE)n+=a(r.nodeValue,t,"html");else if(r.nodeType==Node.COMMENT_NODE)n+=`\x3c!--${r.nodeValue}--\x3e`;else{let e=r.attrs();e.indexOf("for")>=0?(thisclass.parse_values_in_attrs(r,t),n+=thisclass.parse_for(r,t)):e.indexOf("for-key")>=0?(thisclass.parse_values_in_attrs(r,t),n+=thisclass.parse_forkey(r,t)):e.indexOf("com")>=0?(thisclass.parse_values_in_attrs(r,t),n+=thisclass.parse_com(r,t)):n+=thisclass.parse_ele(r,t,i+1)}return i>0&&-1==["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"].indexOf(e.tagName.toLowerCase())&&(n+="</"+e.tagName+">"),n}static parse_dom(e,t){var i=new_ele("div");return i.innerHTML=e,thisclass.parse_ele(i,t,0)}}function _____WINDOW_____(){}window.ut=ut,window.new_lock=ut.new_lock,window.new_named_lock=ut.new_named_lock,window.named_lock=ut.named_lock,window.eval_ctx=ut.eval_ctx,window.d$=ut.d$,window.d$$=ut.d$$,window.e$=ut.e$,window.e$$=ut.e$$,window.get_style=ut.get_style,window.new_ele=ut.new_ele,window.new_ele_svg=ut.new_ele_svg,window.esch=ut.escape_html,window.esca=ut.escape_attr,window.log=console.log,window.logw=console.warn,window.loge=console.error,window.logl=()=>{console.log("-".repeat(40)+"\n")},window.rand_id=()=>Math.random().toString().replace(".",""),window.rand_id_long=()=>`${rand_id()}-${rand_id()}-${rand_id()}`,window.rand_id_str=e=>e+rand_id(),window.touch=(e,t,i=null)=>{null==e[t]&&(e[t]=i)},window.if_=ut.if_,window.for_=ut.for_,window.for_key_=ut.for_key_,window.com_=ut.com_,window.call_=ut.call_,window.call=ut.call_,window.show_menu_=ut.show_menu,window.str=JSON.stringify,window.obj=function(e){try{return JSON.parse(e)}catch{return null}},window.clone=function(e){return obj(str(e))},window.keys=Object.keys,window.props=function(e){return Object.getOwnPropertyNames(Object.getPrototypeOf(e))},window.methods=function(e){var t=[];for(let i of props(e))"constructor"!=i&&"function"==typeof e[i]&&t.push(i);return t},window.extend_to=function(e,t,i){var a=methods(t);Object.setPrototypeOf(t,i),t.super=i;for(let i of a)t[i]=e.prototype[i]};const thisclass=ut,__WEBPACK_DEFAULT_EXPORT__=thisclass},658:(e,t,i)=>{i.d(t,{A:()=>a});const a=class{Name="";Html="";Css="";Data={};Wrapper=null;Key="";constructor(){this.Key=Math.random().toString().replace(".",""),this.$=this.$.bind(this),this.$$=this.$$.bind(this),this.remove_self=this.remove_self.bind(this)}_____UTILS_____(){}$(e){return e$(this.Wrapper,e)}$$(e){return e$$(this.Wrapper,e)}remove_self(){cvm.remove_com(this.Name)}_____CORE_____(){}init(e){if(null!=e){for(let t of methods(e))e[t]=e[t].bind(e);this._init_done=!0}}render(){}rerender(e){null!=e&&(this.Data={...this.Data,...e}),null!=this.pre_rerender&&this.pre_rerender(),cvm.render_com(null,this.Data,null,this)}async load_data(){}}},834:(e,t,i)=>{i.d(t,{A:()=>s});const a=["encrypt","decrypt","wrapKey","unwrapKey"];class n{_____UTILS_____(){}_____Hash_Flow_____(){}static arraybuff2hex(e){return[...new Uint8Array(e)].map((e=>e.toString(16).padStart(2,"0"))).join("")}_____Enc_Flow_____(){}static text2arraybuff(e){return(new TextEncoder).encode(e).buffer}static arraybuff2base64(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}static typedarray2arraybuff(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}_____Dec_Flow_____(){}static hex2uint8arr(e){return Uint8Array.from(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))}static basesf2arraybuff(e){var t=Uint8Array.from(atob(e),(e=>e.charCodeAt(0)));return typedarray2arraybuff(t)}static arraybuff2text(e){return new TextDecoder("utf-8").decode(e)}_____Imex_Flow_____(){}static base64url2base64(e){var t=e.replaceAll("-","+").replaceAll("_","/");return t.length%4!=0&&(t+="=".repeat(4-t.length%4)),t}_____RANDOM_____(){}static rand_bytes(e){return crypto.getRandomValues(new Uint8Array(e))}static rand_iv(){return r.rand_bytes(12)}static rand_uuid(){return window.crypto.randomUUID()}_____ANTI_BF_____(){}static inc_trycounter(e){e.value++}_____HASHING_____(){}static async md5(e){return null}static async sha1(e){var t=await crypto.subtle.digest("SHA-1",text2arraybuff(e));return arraybuff2hex(t)}static async sha256(e){var t=await crypto.subtle.digest("SHA-256",text2arraybuff(e));return arraybuff2hex(t)}static async sha512(e){var t=await crypto.subtle.digest("SHA-512",text2arraybuff(e));return arraybuff2hex(t)}_____SYMETRIC_____(){}_____Keys_____(){}static async gen_key_aes(){return await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,a)}static async gen_statickey_aes(){return await r.gen_key_aes()}static async derive_key_aes(e,t=1e3){var i=await window.crypto.subtle.importKey("raw",text2arraybuff(e),{name:"PBKDF2"},!1,["deriveKey"]),n=Math.random().toString();return await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:text2arraybuff(n),iterations:t,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,a)}_____Encryption_____(){}static async enc_to_base64_aes(e,t){var i=r.rand_iv(),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},t,text2arraybuff(e));return[arraybuff2base64(a),arraybuff2hex(typedarray2arraybuff(i))]}static async dec_from_base64_aes(e,t,i){var a=hex2uint8arr(t),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},i,basesf2arraybuff(e));return arraybuff2text(n)}_____ASYMETRIC_____(){}_____Keys_____(){}static gen_keypair_rsa(){}static gen_keypair_ec(){}_____Encryption_____(){}static enc_to_base64_rsa(e,t){}static dec_from_base64_rsa(e,t){}static enc_to_base64_ec(e,t){}static dec_from_base64_ec(e,t){}_____Signing_____(){}static sign_rsa(e,t){}static verify_rsa(e,t){}static sign_ec(e,t){}static verify_ec(e,t){}_____AUTH_____(){}static reg_pubkey(e="rsa",t){}static sign_greeting(e,t="rsa",i){}_____IMEX_____(){}_____All_Key_Types_____(){}static async export_raw_key(e){var t=await crypto.subtle.exportKey("raw",e);return arraybuff2hex(t)}static async export_jwk_key(e){return await crypto.subtle.exportKey("jwk",e)}_____Im_Aes_____(){}static async import_rawkey_aes(e){var t=hex2uint8arr(e);return await crypto.subtle.importKey("raw",t,{name:"AES-GCM",length:256},!0,a)}static async import_jwkkey_aes(e){var t=basesf2arraybuff(base64url2base64(e.k)),i=arraybuff2hex(t);return await r.import_rawkey_aes(i)}_____Im_Rsa_____(){}_____Im_Ec_____(){}}window.enc_=n,window.text2arraybuff=n.text2arraybuff,window.arraybuff2base64=n.arraybuff2base64,window.arraybuff2hex=n.arraybuff2hex,window.typedarray2arraybuff=n.typedarray2arraybuff,window.basesf2arraybuff=n.basesf2arraybuff,window.hex2uint8arr=n.hex2uint8arr,window.arraybuff2text=n.arraybuff2text,window.base64url2base64=n.base64url2base64;const r=n,s=n},842:(e,t,i)=>{i.d(t,{A:()=>l});var a=i(620),n=i(850),r=(i(923),i(834),i(473));window._Screen_Html={},window._Screen_Css={},window._Com_Html={},window._Com_Css={};class s{static Screens={};static Coms={};static Menus={};static Key2Controller={};_____UTILS_____(){}static set_title(e){document.title=e}static com_is_loaded(e){return null!=d$(`div[com-name="${e}"]`)}static get_screen(e){return _.Screens[e].Instance}static get_last_com(e){return _.Coms[e].Instance}static remove_com(e){var t=d$$(`div[com-name="${e}"]`);if(null!=t&&0!=t.length)for(let e of t)e.remove()}static parse_h(e){if(null==e)return logw("cvm.js/parse_h: Some HTML is null, empty HTML file somewhere?"),"";var t=e.split("\n");for(let e=0;e<t.length;e++)t[e].indexOf("$1{for_(")>=0&&(t[e]=t[e].trimRight()+"\\`"),t[e].indexOf("${for_(")>=0&&(t[e]=t[e].trimRight()+"`"),t[e].indexOf("$1{for_key_(")>=0&&(t[e]=t[e].trimRight()+"\\`"),t[e].indexOf("${for_key_(")>=0&&(t[e]=t[e].trimRight()+"`"),t[e]=t[e].replaceAll("#$1","\\`)}"),t[e]=t[e].replaceAll("#$","`)}"),t[e]=t[e].replaceAll("$2{","\\\\\\${"),t[e]=t[e].replaceAll("$1{","\\${");return t.join("\n")}_____CORE_____(){}static init(){r.A.init()}static init_screen(e,t,i,a){s.Screens[e]={Class:t,Html:i.toString(),Css:a.toString(),Html_Parsed:_.parse_h(i),Instance:{}}}static init_com(e,t,i,a){s.Coms[e]={Class:t,Html:i.toString(),Css:a.toString(),Html_Parsed:_.parse_h(i),Instance:{}}}static render_screen(e,t){var i=s.Screens[e];if(null!=i?.Class){var n=new i.Class(t);n.Name=e,n.Data=t,n.Data._Con=n,n.init(),1!=n._init_done&&loge(`Screen ${e}: Must inherit 'init' and call super.init(this) inside init method`);var r=d$("body");if(r.innerHTML=a.A.parse_dom(a.A.eval_ctx("`"+i.Html_Parsed+"`",n.Data),n.Data),r.attr("screen-name",e),null==d$(`style[screen-name="${e}"]`)){var l=d$("head"),o=new_ele("style");o.textContent=i.Css,o.attr("screen-name",e),l.appendChild(o)}for(let e in _.Key2Controller){let t=d$(`div[key="${e}"]`),i=_.Key2Controller[e];null!=t?(t.Controller=i,i.Wrapper=t):loge("cvm.js/render_screen: No wrapper in DOM for:",i),delete _.Key2Controller[e]}return r.Controller=n,n.Wrapper=r,_.Screens[e].Instance=n,n.render(),n.load_data(),n}loge("cvm.js: Screen has not been init'ed:",e)}static render_com(e,t,i,n=!1,r=!1){var l,o=null==e;o&&((l=n).Wrapper=d$(`div[key="${l.Key}"]`),e=l.Name,i=l.Wrapper.parentElement);var d=s.Coms[e];if(null!=d?.Class){o?(l.Data=t,l.Data._Key=l.Key):((l=new d.Class(t)).Name=e,l.Data=t,l.Data._Key=l.Key,l.Data._Con=l,l.init(),"string"==typeof i&&"get-all"!=i&&(i=d$(i)),1!=l._init_done&&loge(`Component ${e}: Must inherit 'init' and call super.init(this) inside init method`));var c=new_ele("div");if(c.innerHTML=a.A.parse_dom(a.A.eval_ctx("`"+d.Html_Parsed+"`",l.Data),l.Data),c.attr("com-name",e),c.attr("key",l.Key),!0===r?c.attr("style","display:inline-block;"):c.attr("style","display:block; flex:1;"),c.classList.add("com-wrapper"),o)l.Wrapper.replaceWith(c);else if(null!=i&&"get-all"!=i){n||(i.innerHTML=""),i.appendChild(c);for(let e in _.Key2Controller){let t=d$(`div[key="${e}"]`),i=_.Key2Controller[e];null!=t?(t.Controller=i,i.Wrapper=t):loge("cvm.js/render_com: No wrapper in DOM for:",i),delete _.Key2Controller[e]}}else _.Key2Controller[l.Key]=l;if(!o&&null==d$(`style[com-name="${e}"]`)){var u=d$("head"),h=new_ele("style");h.textContent=d.Css,h.attr("com-name",e),u.appendChild(h)}return l.Wrapper=c,l.Wrapper.Controller=l,_.Coms[e].Instance=l,l.render(c),l.load_data(c),null==i?c.outerHTML:"get-all"==i?[l,c.outerHTML]:l}loge("cvm.js: Component has not been init'ed:",e)}static reg_menu(e,t){_.Menus[e]=t}static get_menu(e){return _.Menus[e]}static async dyn_screens(e){for(let t in e){let i,a,r=e[t],s=r[0],l=r[1];null!=window._Screen_Html&&null!=window._Screen_Html[t]?(i=window._Screen_Html[t],a=window._Screen_Css[t]):(i=await n.A.get(`${l}/${t}.html`,"text/plain"),a=await n.A.get(`${l}/${t}.css`,"text/plain")),_.init_screen(t,s,i,a)}}static async dyn_coms(e){for(let t in e){let i,a,r=e[t],s=r[0],l=r[1];null!=window._Com_Html&&null!=window._Com_Html[t]?(i=window._Com_Html[t],a=window._Com_Css[t]):(i=await n.A.get(`${l}/${t}.html`,"text/plain"),a=await n.A.get(`${l}/${t}.css`,"text/plain")),_.init_com(t,s,i,a)}}}window.cvm_=s,window.cvm=s,window.extend=Object.setPrototypeOf;const _=s,l=s},850:(e,t,i)=>{i.d(t,{A:()=>_});var a=i(473);const n=class{static get_email(){}static get_sid(){}};class r{static Auth=n;static async get(e,t="application/json"){try{var i=await(await fetch(e)).text();if("application/json"==t)try{return JSON.parse(i)}catch{return null}return i}catch{return null}}static async post(e,t,i="application/json"){try{var a=await fetch(e,{method:"POST",body:JSON.stringify(t)}),n=await a.text();if("application/json"==i)try{return JSON.parse(n)}catch{return log("Non JSON response:",n),null}return n}catch{return null}}static async call_api(e,t={}){var i=s.Auth.get_email(),n=s.Auth.get_sid();return null==n||0==n.length?(a.A.alert(__h("YOU_NEED_TO_LOGIN_FIRST")),new Error("need-auth")):(null==t&&(t={}),t.Email_=i,t.Sid_=n,await s.post(e,t))}static async call_pub_api(e,t={}){return await s.post(e,t)}_____CORE_____(){}static init(e){s.Auth=e}}window.net=r;const s=r,_=r},923:(e,t,i)=>{i.d(t,{A:()=>s});var a=i(138);class n{static Rootdir=null;_____NODES_____(){}_____Node_Utils_____(){}static async get_altname_of(e){if(null!=e&&0!=e.trim().length){var t=r.Rootdir;if(-1==e.indexOf("/"))var i=e,n=await a.A.dir_path2file(t,"wpower.gfsi");else{let r=e.split("/");i=r[r.length-1];let s=r.slice(0,r.length-1).join("/");n=await a.A.dir_path2file(t,s+"/wpower.gfsi")}var[s,_]=await a.A.read_file(n);if(0==_.trim().length)return null;var l=obj(_);return l.Altnames?l.Altnames[i]:null}}static async get_altnames_in(e){var t=r.Rootdir;if(null==e||0==e.trim().length)var i=await a.A.dir_path2file(t,"wpower.gfsi");else i=await a.A.dir_path2file(t,e+"/wpower.gfsi");var[n,s]=await a.A.read_file(i);if(0==s.trim().length)return{};var _=obj(s);return _.Altnames?_.Altnames:{}}static async get_excnames_in(e){var t=r.Rootdir;if(null==e||0==e.trim().length)var i=await a.A.dir_path2file(t,"wpower.gfsi");else i=await a.A.dir_path2file(t,e+"/wpower.gfsi");var[n,s]=await a.A.read_file(i);if(0==s.trim().length)return[];var _=obj(s);return _.Excnames?_.Excnames:[]}_____Node_Crud_____(){}static async create_real_node(e){if(null!=e&&0!=e.trim().length){if(await a.A.dir_file_exists(r.Rootdir,e+".gfsn"))return new Error("gfsn-file-exists-of-same-name");await a.A.dir_path2dir(r.Rootdir,e),await a.A.dir_path2dir(r.Rootdir,e+"/index.md")}else loge("gfs.js: Error: Path can't be blank")}static async create_sym_node(e,t,i){if(null==e&&(e=""),null!=t&&0!=t.trim().length)if(null!=i&&0!=i.trim().length){if(await a.A.dir_dir_exists(r.Rootdir,e))return new Error("dir-exists-of-same-name");if(0==e.trim().length)var n=await a.A.dir_path2file(r.Rootdir,t+".gfsn");else n=await a.A.dir_path2file(r.Rootdir,e+"/"+t+".gfsn");await a.A.write_file(n,i)}else loge("gfs.js: Error: Target_Path can't be blank");else loge("gfs.js: Error: Name can't be blank")}static async read_node(e){if(null==e||0==e.trim().length)return null;e=e.replace(/\.gfsn$/,"");var t=r.Rootdir;return await a.A.dir_dir_exists(t,e)?{Path:e,real:!0,sym:!1,Nexts:await r.get_nexts_of(e),Altname:await r.get_altname_of(e)}:await a.A.dir_file_exists(t,e+".gfsn")?{Path:e,real:!1,sym:!0,Nexts:await r.get_nexts_of(e),Altname:await r.get_altname_of(e)}:null}static async update_node_name(e,t){e=e.trim();var i=r.Rootdir;if(-1==e.indexOf("/"))var n=e,s=await a.A.dir_path2file(i,"wpower.gfsi");else{let t=e.split("/");n=t[t.length-1];let r=t.slice(0,t.length-1).join("/");s=await a.A.dir_path2file(i,r+"/wpower.gfsi")}var[_,l]=await a.A.read_file(s);0==l.trim().length&&(l="{}");var o=obj(l);null==o.Altnames&&(o.Altnames={}),o.Altnames[n]=t,await a.A.write_file(s,str(o,null,4))}static async update_node_target(e,t){if(0!=(e=e.trim()).length){var i=r.Rootdir,n=await a.A.dir_path2file(i,e+".gfsn");await a.A.write_file(n,t.trim())}}static async update_node_weight(e,t){e=e.trim();var i=r.Rootdir;if(-1==e.indexOf("/"))var n=e,s=await a.A.dir_path2file(i,"wpower.gfsi");else{let t=e.split("/");n=t[t.length-1];let r=t.slice(0,t.length-1).join("/");s=await a.A.dir_path2file(i,r+"/wpower.gfsi")}var[_,l]=await a.A.read_file(s);0==l.trim().length&&(l="{}");var o=obj(l);null==o.Weights&&(o.Weights={}),o.Weights[n]=t,await a.A.write_file(s,str(o,null,4))}static async update_node_edge(e,t){e=e.trim();var i=r.Rootdir;if(-1==e.indexOf("/"))var n=e,s=await a.A.dir_path2file(i,"wpower.gfsi");else{let t=e.split("/");n=t[t.length-1];let r=t.slice(0,t.length-1).join("/");s=await a.A.dir_path2file(i,r+"/wpower.gfsi")}var[_,l]=await a.A.read_file(s);0==l.trim().length&&(l="{}");var o=obj(l);null==o.Edges&&(o.Edges={}),o.Edges[n]=t,await a.A.write_file(s,str(o,null,4))}static async delete_node(e){e=e.trim();var t=r.Rootdir;if(-1==e.indexOf("/"))var i=e,n=await a.A.dir_path2file(t,"wpower.gfsi");else{let r=e.split("/");i=r[r.length-1];let s=r.slice(0,r.length-1).join("/");n=await a.A.dir_path2file(t,s+"/wpower.gfsi")}var[s,_]=await a.A.read_file(n);0==_.trim().length&&(_="{}");var l=obj(_);null==l.Excnames&&(l.Excnames=[]),-1==l.Excnames.indexOf(i)&&l.Excnames.push(i),await a.A.write_file(n,str(l,null,4))}_____Node_Others_____(){}static async pin_node(e){var t=await a.A.dir_path2file(r.Rootdir,"wpower.gfs"),[i,n]=await a.A.read_file(t),s=obj(n);null==s.Pinneds?s.Pinneds=[e]:-1==s.Pinneds.indexOf(e)&&s.Pinneds.push(e),await a.A.write_file(t,str(s,null,4))}static async get_pinned_nodes(e){var t=await a.A.dir_path2file(r.Rootdir,"wpower.gfs"),[i,n]=await a.A.read_file(t),s=obj(n);return null==s.Pinneds?[]:s.Pinneds}static async get_node_weights(e){if(null==e||0==e.trim().length)var t="wpower.gfsi";else t=e+"/wpower.gfsi";var i=await a.A.dir_path2file(r.Rootdir,t),[n,s]=await a.A.read_file(i);if(0==s.trim().length)return{};var _=obj(s);return null==_.Weights?{}:_.Weights}_____EDGES_____(){}static async get_nexts_of(e){if(await a.A.dir_file_exists(r.Rootdir,e+".gfsn")){let t=await a.A.dir_path2file(r.Rootdir,e+".gfsn"),[i,n]=await a.A.read_file(t);e=n.trim()}if(null==e&&(e=""),0==(e=e.trim()).length)var t=r.Rootdir;else t=await a.A.dir_path2dir(r.Rootdir,e);var i=await a.A.dir_get_subdirs(t),n=await a.A.dir_get_files(t),s=[];for(let t of n)if(null!=t.name.match(/\.gfsn$/)){let i;i=0==e.length?t.name.replace(".gfsn",""):e+"/"+t.name.replace(".gfsn",""),s.push({Path:i,sym:!0,real:!1,Nexts:null,Altname:await r.get_altname_of(i)})}var _=[];for(let t of i)0==e.trim().length?_.push({Path:t.name,sym:!1,real:!0,Nexts:null,Altname:await r.get_altname_of(t.name)}):_.push({Path:e+"/"+t.name,sym:!1,real:!0,Nexts:null,Altname:await r.get_altname_of(e+"/"+t.name)});var l=[..._,...s];return l.filter((e=>e.Path.trim().length>0))}_____OVERALL_____(){}static async recurse_for_nodes(e,t,i,n){var s=await a.A.dir_get_items(t);for(let _ of s){if("directory"!=_.kind&&null==_.name.match(/\.gfsn$/))continue;let s=null==i?_.name:i+"/"+_.name,l=await r.read_node(s);if(e.push({...l,depth:n}),!l.sym){let i=await a.A.dir_path2dir(t,_.name);await r.recurse_for_nodes(e,i,s,n+1)}}}static async is_unconnected(e){if(0!=e.depth)return!1;if(e.real){let t=await a.A.dir_path2dir(r.Rootdir,e.Path);return 0==(await a.A.dir_get_items(t)).length}{let t=await a.A.dir_path2file(r.Rootdir,e.Path+".gfsn"),[i,n]=await a.A.read_file(t);return 0==n.trim().length}}static async get_all_nodes(){var e=[];await r.recurse_for_nodes(e,r.Rootdir,null,0);var t={All:e,Realnodes:[],Symnodes:[],Starters:[],Unconnecteds:[],Pinneds:[]};for(let i of e){let e=await r.is_unconnected(i);i.real&&t.Realnodes.push(i),i.sym&&t.Symnodes.push(i),0==i.depth&&(e?t.Unconnecteds.push(i):t.Starters.push(i))}return t.Pinneds=await r.get_pinned_nodes(),t}_____INTEGRITY_____(){}static async check_integrity(){}static async fix_integrity(e,t){}_____CORE_____(){}static async init(){try{logw("gfs.js/init: Note: Do not pick a dir inside already init'ed GFS");var e=await a.A.pick_dir();if(null==e)return void logw("gfs.js/init: User aborted pick-dir dialog");var t=await a.A.dir_get_items(e),i=await a.A.dir_file_exists(e,"wpower.gfs");if(t.length>0&&!i)return void log("Error: Not Wpower GFS folder and it's not empty");if(await a.A.dir_file_exists(e,"wpower.gfs"))return log("gfs.js: GFS already init'ed in",e.name),r.Rootdir=e,"ok";var n=await a.A.dir_path2file(e,"wpower.gfs");return await a.A.write_file(n,"{}"),r.Rootdir=e,"ok"}catch(e){return void log("gfs.js/init:",e)}}static async init_fts(){}}window.gfs=n;const r=n,s=n}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},base_controller=__webpack_require__(658),index_cvm=__webpack_require__(842),files=__webpack_require__(138),Phrases={LC_ITEMS:{en_int:"items"},LOADING:{en_int:"Loading"},IC_USE_AUTO_LAYOUT:{en_int:"🅰️Use Auto-layout"},IC_USE_CUSTOM_LAYOUT:{en_int:"🖼️Use Custom Layout"},ENTER_NEW_NODE_NAME_:{en_int:"Enter new node name:"},IC_CREATE_NODE:{en_int:"➕Create Node"},IC_LINK_EXISTING_NODE:{en_int:"🔗Link Existing Node"},SURE_TO_DELETE_THAT_NODE_:{en_int:"Sure to delete that node?"},ENTER_NEW_NAME_:{en_int:"Enter new name:"},IC_EDIT_NAME:{en_int:"📝Edit Name"},IC_DELETE_NODE:{en_int:"❌Delete Node"},ENTER_NEW_EDGE_NAME_:{en_int:"Enter new edge name:"},IC_EDIT_EDGE:{en_int:"📝Edit Edge"},IC_DELETE_EDGE:{en_int:"❌Delete Edge"},EDIT_EDGE_OR_DELETE_:{en_int:"Edit edge or delete?"},ENTER_EDGE_NAME_:{en_int:"Enter edge name:"},CREATE_EDGE_FROM:{en_int:"Create edge from"},NO_SECTION:{en_int:"No Section"},CANT_DRAG_INSIDE:{en_int:"Can't drag inside"},IC_ADD_CHILD:{en_int:"➕Add Child"},IC_RENAME:{en_int:"📝Rename"},IC_DELETE:{en_int:"❌Delete"},CLICK_ICON_TO_TOGGLE_CHILDREN:{en_int:"Click icon to toggle children"},HELLO:{en_int:"Hello",it_ita:"Ciao",vi_vnm:"Chào"},PICK_COLOUR:{en_int:"Pick Colour",it_ita:"Scegli Colore",vi_vnm:"Chọn Mầu"},ENTER_TWICE_TO_GET_OUT_OF_DOT:{en_int:"Enter twice to get out of dot"},OKAY:{en_int:"Okay",it_ita:"Bene",vi_vnm:"Đồng ý"},CANCEL:{en_int:"Cancel",it_ita:"Annula",vi_vnm:"Hủy"},MESSAGE:{en_int:"Message",it_ita:"Messaggio",vi_vnm:"Thông báo"},INPUT:{en_int:"Input",it_ita:"Input",vi_vnm:"Nhập liệu"},DIALOG:{en_int:"Dialog",it_ita:"Dialogo",vi_vnm:"Hội thoại"},SELECT:{en_int:"Select",it_ita:"Scegli",vi_vnm:"Lựa chọn"},CONFIRMATION:{en_int:"Confirmation",it_ita:"Confirmazione",vi_vnm:"Khẳng định"},YES:{en_int:"Yes",it_ita:"Sì",vi_vnm:"Có"},NO:{en_int:"No",it_ita:"No",vi_vnm:"Không"}};const phrases=Phrases;function _____CLASS_____(){}class lang{static Phrases=phrases;_____UTILS_____(){}static set_lang(e){localStorage.Lang=e}static cur_lang(e){var t=localStorage.Lang;return null!=t&&0!=t.trim().length||(t="en-int"),t}static const2phrase(e){var t=localStorage.Lang;return null!=t&&0!=t.trim().length||(t="en-int"),null==thisclass.Phrases[e]||null==thisclass.Phrases[e][t.replace("-","_")]?e:thisclass.Phrases[e][t.replace("-","_")]}static const2phrase_html(e){return thisclass.const2phrase(e).replaceAll("<","&lt;").replaceAll(">","&gt;")}static const2phrase_attr(e){return thisclass.const2phrase(e).replaceAll("'","&apos;").replaceAll('"',"&quot;").replaceAll("\n"," ")}static __h(e){return thisclass.const2phrase_html(e)}static __a(e){return thisclass.const2phrase_attr(e)}_____CORE_____(){}static set_phrases(e){thisclass.Phrases={...thisclass.Phrases,...e}}}window.lang=lang,window.__=lang.const2phrase,window.__h=lang.const2phrase_html,window.__a=lang.const2phrase_attr;const thisclass=lang,lang_0=thisclass;var net=__webpack_require__(850),index_ui=__webpack_require__(473),ut=__webpack_require__(620),gfs=__webpack_require__(923);function OX_INDENT_intersect(){}function fts_CLASS_(){}class fts{static MIN_TOK_LEN=2;static MAX_RESULTS=100;static Nofts=["wpower","fts","metadata"];static Fts_Exc=["the","this","that","a","an","i","you"];static str_from_obj(e){var t="";return JSON.stringify(e,((e,i)=>"string"!=typeof i||"Idstr"==e?i:void(t+=" "+i))),t=t.trim().replace(/[\s]{2,}/g," ")}static async upsert_tokens(e,t,i,a){if(!(fts_thisclass.Nofts.indexOf(t)>=0)){var n=fts_thisclass.str_from_obj(i).toLowerCase().split(" ").filter((e=>e.length>=fts_thisclass.MIN_TOK_LEN));n=n.filter((e=>-1==fts_thisclass.Fts_Exc.indexOf(e)));var r=(await idb_0.reopen(e)).transaction("fts",RW);for(let e of n){let i;null==await idb_0.find_one(r,{store__token__target:[t,e,a]})&&await idb_0.insert_one(r,{Store:t,Token:e,Target:a},null,i=!1)}}}static async remove_tokens(e,t,i,a){if(!(fts_thisclass.Nofts.indexOf(t)>=0)){var n=fts_thisclass.str_from_obj(i).toLowerCase().split(" ").filter((e=>e.length>=fts_thisclass.MIN_TOK_LEN));n=n.filter((e=>-1==fts_thisclass.Fts_Exc.indexOf(e)));var r=(await idb_0.reopen(e)).transaction("fts",RW);for(let e of n){let i;null!=await idb_0.find_one(r,{store__token__target:[t,e,a]})&&await idb_0.remove_one(r,{store__token__target:[t,e,a]},i=!1)}}}static async find_text(e,t,i){if(fts_thisclass.Nofts.indexOf(t)>=0)return[];var a=i.trim().toLowerCase().replace(/[\s]{2,}/g," ").split(" ");if(0==(a=[...new Set(a)]).length)return[];function n(e,t){const i=e.length<=t.length?e:t,a=e.length>t.length?e:t,n=new Set(i);return a.filter((e=>n.has(e)))}a.sort(((e,t)=>t.length-e.length));var r=(await idb_0.reopen(e)).transaction("fts",RO),s=(await idb_0.find_many(r,{store__token:[t,a[0]]})).map((e=>e.Target));if(0==s.length)return[];for(let e=1;e<a.length;e++){let i=a[e];if(0==(s=n(s,(await idb_0.find_many(r,{store__token:[t,i]})).map((e=>e.Target)))).length)return[]}s=s.slice(0,fts_thisclass.MAX_RESULTS);var _=[];r=(await idb_0.reopen(e)).transaction(t,RO);for(let e of s){let t=await idb_0.find_one(r,{idstr:e});null!=t&&_.push(t)}return _}}const fts_thisclass=fts,fts_0=fts_thisclass;function OX_INDENT_onsuccess_onupgradeneeded(){}function _____LITERALS_____(){}function idb_CLASS_(){}window.one=0,window.one_u=1,window.arr=2,window.arr_u=3,window.RO="readonly",window.RW="readwrite",window.D_AZ="next",window.D_AZ_UNIQ="nextunique",window.D_ZA="prev",window.D_ZA_UNIQ="prevunique",window.STOP="stop",window.gte=function(e){return IDBKeyRange.lowerBound(e)},window.gt=function(e){return IDBKeyRange.lowerBound(e,!0)},window.lte=function(e){return IDBKeyRange.upperBound(e)},window.lt=function(e){return IDBKeyRange.upperBound(e,!0)},window.in_with_lr=function(e,t){return IDBKeyRange.bound(e,t)},window.in_without_lr=function(e,t){return IDBKeyRange.bound(e,t,!0,!0)},window.in_with_r=function(e,t){return IDBKeyRange.bound(e,t,!0,!1)},window.in_with_l=function(e,t){return IDBKeyRange.bound(e,t,!1,!0)},window.eq=function(e){return IDBKeyRange.only(e)},window.range2name=function(e){if(null!=e.lower)var t="x";else t="null";if(null!=e.upper)var i="x";else i="null";var a=`${t}/${e.lowerOpen}/${i}/${e.upperOpen}`;return"x/false/x/false"==a?e.lower==e.upper?"eq":"in_with_lr":"x/false/null/true"==a?"gte":"x/true/null/true"==a?"gt":"null/true/x/false"==a?"lte":"null/true/x/true"==a?"lt":"x/false/x/false"==a?"in_with_lr":"x/true/x/true"==a?"in_without_lr":"x/true/x/false"==a?"in_with_r":"x/false/x/true"==a?"in_with_l":void 0},window.itype2str=function(e){return e==one?"one":e==one_u?"one_u":e==arr?"arr":e==arr_u?"arr_u":void 0},window.s1=function(e){var t=e.objectStoreNames[0];return e.objectStore(t)};class idb{static db_ready=!1;static syncable=!1;static Nosyncs=["wpower","fts","metadata"];_____UTILS_____(){}static valid_indexes(e){if(!e instanceof Object)return!1;if(null!=e.wpower)return loge("idb.js/valid_indexes: Store name can't be 'wpower'"),!1;for(let t in e)if(e[t].length%2!=0)return!1;for(let t in e)for(let i in e[t]){if("id"==i||i instanceof Array&&1==i.length&&"id"==i[0])return!1;if("Idstr"==i||i instanceof Array&&1==i.length&&"Idstr"==i[0])return!1}for(let t in e)for(let i=0;i<e[t].length;i++){let a=e[t][i];if(i%2==0){if("string"!=typeof a&&!(a instanceof Array))return!1}else if("number"!=typeof a)return!1}return!0}static async get_cur_ver(e){const t=window.indexedDB.open(e);var[i,a]=new_lock();return t.onsuccess=e=>{let i=t.result;a(i.version),i.close()},await i}static async get_store_names(e){const t=window.indexedDB.open(e);var[i,a]=new_lock();return t.onsuccess=e=>{let i=t.result;a([...i.objectStoreNames]),i.close()},await i}static filter_for_new_names(e,t){var i=[];for(let a of t)-1==e.indexOf(a)&&i.push(a);return i}static field_to_idx_name(e){if("string"==typeof e)return e.toLowerCase().replaceAll(".","_").replace(/[^0-9A-Za-z_]/,"_");var t=JSON.stringify(e);return(t=t.replaceAll('","',"__")).replaceAll(".","_").replaceAll('"',"").replaceAll("[","").replaceAll("]","").replace(/[^0-9A-Za-z_]/,"_").toLowerCase()}static add_indexes_for_ops(e){for(let t in e){let i=e[t].length;if(0!=i){for(let a=0;a<i/2;a++){let i,n=e[t][2*a];i="string"==typeof n?["id",n]:["id"].concat(n),e[t].push(i),e[t].push(one_u)}e[t].push("Idstr"),e[t].push(one_u)}}return e}static async get_index_names(e,t){var i=window.indexedDB.open(e),[a,n]=new_lock(),r={};return i.onsuccess=e=>{var i=e.target.result,a=[...i.objectStoreNames],s=[];if(0==a.length)return i.close(),void n(r);for(let e of t)a.indexOf(e)>=0&&s.push(e);var _=i.transaction(s,"readonly");for(let e of s){let t=[..._.objectStore(e).indexNames].sort();r[e]=t}i.close(),n(r)},await a}static has_new_indexes(e,t){var i=0;for(let a in e){let n,r=e[a].sort();n=null==t[a]?[]:t[a],n=n.filter((e=>"number"!=typeof e));for(let e=0;e<n.length;e++)n[e]=idb_thisclass.field_to_idx_name(n[e]);let s=n.sort();for(let e of s)-1==r.indexOf(e)&&(log(`idb.js: New index in store '${a}': ${e}`),i++)}return i>0}static async do_upgrade(e,t,i,a){var n=window.indexedDB.open(e,t+1),[r,s]=new_lock();n.onupgradeneeded=e=>{let t=e.target.result;for(let e of i)t.createObjectStore(e,{keyPath:"id",autoIncrement:!0});let n=e.target.transaction;for(let e in a){let t=n.objectStore(e),i=a[e].length;for(let n=0;n<i/2;n++){let i=a[e][2*n],r=a[e][2*n+1],s=r==arr||r==arr_u,_=r==one_u||r==arr_u;try{t.createIndex(idb_thisclass.field_to_idx_name(i),i,{unique:_,multiEntry:s})}catch(e){"ConstraintError"==e.name||loge("idb.js: Error:",i,"->",itype2str(r)+",",e)}}}t.close(),s()},await r}_____CORE_____(){}static new_idstr(){for(var e=Number.MAX_SAFE_INTEGER.toString().length,t=Date.now().toString();t.length<e;)t="0"+t;for(var i=Math.random().toString().replace(".","").substring(0,e);i.length<e;)i="0"+i;return t+"-"+i}static async open(e,t){if(idb_thisclass.valid_indexes(t)){t.wpower=["Key",one_u,"Value",one],t.fts=["Store",one,"Token",one,"Target",one,["Store","Token"],one,["Store","Token","Target"],one_u],t.graph=["Node_Store",one,"Node_Idstr",one,"Nexts",arr,"is_pinned",one,"Edge_Names",one];var i=await idb_thisclass.get_cur_ver(e),a=await idb_thisclass.get_store_names(e),n=idb_thisclass.filter_for_new_names(a,keys(t));if(log("idb.js: Current ver :",i),log("idb.js: Stores found:",a),log("idb.js: New stores  :",n),log("idb.js: Object ref  : Use Idstr, because 'id' is autoinc per device"),t=idb_thisclass.add_indexes_for_ops(t),keys(t).length>0)var r=await idb_thisclass.get_index_names(e,keys(t));else r={};(n.length>0||idb_thisclass.has_new_indexes(r,t))&&await idb_thisclass.do_upgrade(e,i,n,t),idb_thisclass.db_ready=!0}else loge("Error, bad indexes:",t)}static async open_syncable(e,t){if(null!=gfs.A.Rootdir){try{await files.A.make_rw(gfs.A.Rootdir)}catch{return void loge("idb.js/open_syncable: gfs.Rootdir has no RW permissions")}idb_thisclass.syncable=!0,await idb_thisclass.open(e,t);var i=(await idb_thisclass.reopen(e)).transaction("wpower",RW);if(null==await idb_thisclass.find_one(i,{key:"device-info"})){let e=idstr();await idb_thisclass.insert_one(i,{Key:"device-info",Value:{Id:e,Name:"Device "+e}})}await idb_thisclass.sync_after_open(e)}else loge("idb.js/open_syncable: gfs.Rootdir is null, gfs.init is needed")}static async reopen(e){if(!idb_thisclass.db_ready)return loge("idb.js: Error: Must call 'open' once (only once) before"),null;const t=window.indexedDB.open(e);var[i,a]=new_lock();return t.onsuccess=e=>{let i=t.result;a(i)},await i}_____CRUD_____(){}_____Crud_Utils_____(){}static index_name_exists(e,t){return"id"==t||[...e.indexNames].indexOf(t)>=0}static parse_cond(e){for(let t in e)e[t]instanceof IDBKeyRange||(e[t]=eq(e[t]));return e}static async set_by_id(e,t){var i=s1(e).put(t),[a,n]=new_lock();return i.onsuccess=e=>{n(t.id)},await a}static async get_by_id(e,t,i=null){var a=s1(e).get(eq(t)),[n,r]=new_lock();return a.onsuccess=e=>{null!=i&&i(e.target.result),r(e.target.result)},await n}static async del_by_id(e,t){var i=s1(e).delete(eq(t)),[a,n]=new_lock();return i.onsuccess=e=>{n(t)},await a}static async find(e,t,i=!0,a=!0){var n=s1(e);t=idb_thisclass.parse_cond(t);for(let e in t)if(!idb_thisclass.index_name_exists(n,e))return void loge(`idb.js: find: Error: Missing index ${e} in store ${n.name}, maybe the conditions to find are field names instead of index names?`);if(0==keys(t).length){var r=[];return await idb_thisclass.open_cursor(e,"id",gte(0),D_AZ,((e,t,a)=>{if(r.push(t),i)return STOP})),i?a?r[0]:r[0]?.id:a?r.sort(((e,t)=>e.id-t.id)):r.map((e=>e.id)).sort()}if(1==keys(t).length){r=[];var s=keys(t)[0],_=t[s];return await idb_thisclass.open_cursor(e,s,_,D_AZ,((e,t,a)=>{if(r.push(t),i)return STOP})),i?a?r[0]:r[0]?.id:a?r.sort(((e,t)=>e.id-t.id)):r.map((e=>e.id)).sort()}var l={},o=[],d=!1;for(let e in t)if("eq"==range2name(t[e])){o=[e].concat(keys(t).filter((t=>t!=e))),d=!0;break}if(!d){for(let i in t)l[i]=await idb_thisclass.count_range(e,i,t[i]);(o=keys(t)).sort(((e,t)=>l[e]-l[t]))}if(0==o[0])return i?null:[];var c=o[0],u=new Set([]);await idb_thisclass.open_cursor(e,c,t[c],D_AZ,((e,t,i)=>{u.add(t.id)}));var h=o.slice(1);if(h.indexOf("id")>=0){let e=range2name(t.id),i=t.id.lower,a=t.id.upper,n=i==a?i:null,r=[...u];"eq"==e?r=[n]:"gte"==e?r=r.filter((e=>e>=i)):"gt"==e?r=r.filter((e=>e>i)):"lte"==e?r=r.filter((e=>e<=a)):"lt"==e?r=r.filter((e=>e<a)):"in_with_lr"==e?r=r.filter((e=>e>=i&&e<=a)):"in_without_lr"==e?r=r.filter((e=>e>i&&e<a)):"in_with_r"==e?r=r.filter((e=>e>i&&e<=a)):"in_with_l"==e&&(r=r.filter((e=>e>=i&&e<a))),u=new Set(r),o=[o[0]].concat(h.filter((e=>"id"!=e)))}for(let i=1;i<o.length;i++){let a=o[i],n="id__"+a,r=new Set(u);for(let i of[...u]){let s={},_=t[a],l=range2name(_),o=_.lower,d=_.upper,c=o==d?o:null;"eq"==l?s[n]=eq([i,c]):"gte"==l?s[n]=gte([i,o]):"gt"==l?s[n]=gt([i,o]):"lte"==l?s[n]=lte([i,d]):"lt"==l?s[n]=lt([i,d]):"in_with_lr"==l?s[n]=in_with_lr([i,o],[i,d]):"in_without_lr"==l?s[n]=in_without_lr([i,o],[i,d]):"in_with_r"==l?s[n]=in_with_r([i,o],[i,d]):"in_with_l"==l&&(s[n]=in_with_l([i,o],[i,d])),null==await idb_thisclass.find(e,s,!0)&&r.delete(i)}u=r}if(0==(u=[...u].sort()).length)return i?null:[];if(i){let t=await idb_thisclass.get_by_id(e,u[0]);return a?t:t.id}if(a){let t=[],i=[];for(let a of u)t.push(idb_thisclass.get_by_id(e,a,(e=>{i.push(e)})));return await Promise.all(t),i.sort(((e,t)=>e.id-t.id)),i}return u}_____Sync_Utils_____(){}static is_syncable(){return!0===idb_thisclass.syncable&&null!=gfs.A.Rootdir}static async sync_after_insert(e,t,i){if(!(idb_thisclass.Nosyncs.indexOf(e)>=0))if(idb_thisclass.is_syncable()){var a=await files.A.dir_path2file(gfs.A.Rootdir,`#idb/${e}/${t}.json`);await files.A.write_file(a,str(i,null,4))}else logw("idb.js/sync_after_insert: Can't sync, check open_syncable, gfs.Rootdir")}static async sync_after_update(e,t,i){if(!(idb_thisclass.Nosyncs.indexOf(e)>=0))if(idb_thisclass.is_syncable()){var a=await files.A.dir_path2file(gfs.A.Rootdir,`#idb/${e}/${t}.json`);await files.A.write_file(a,str(i,null,4))}else logw("idb.js/sync_after_update: Can't sync, check open_syncable, gfs.Rootdir")}static async sync_after_upsert(e,t,i){}static async sync_after_remove(e,t){if(!(idb_thisclass.Nosyncs.indexOf(e)>=0))if(idb_thisclass.is_syncable()){var i=await files.A.dir_path2file(gfs.A.Rootdir,`#idb/${e}/${t}.json`);await files.A.write_file(i,"{}")}else logw("idb.js/sync_after_remove: Can't sync, check open_syncable, gfs.Rootdir")}static async mark_changed(e,t,i){if(!(idb_thisclass.Nosyncs.indexOf(t)>=0))if("string"==typeof i&&(i=[i]),null!=gfs.A.Rootdir){var a=gfs.A.Rootdir;await files.A.dir_path2dir(a,"#devices");var n=(await idb_thisclass.reopen(e)).transaction("wpower",RW),r=(await idb_thisclass.find_one(n,{key:"device-info"})).Value,s="#devices/"+r.Id+".json";if(!await files.A.dir_file_exists(a,s)){let e=await files.A.dir_path2file(a,s);await files.A.write_file(e,str({Id:r.Id,Name:r.Name,Obj2Load:{}},null,4))}var _=await files.A.dir_path2dir(a,"#devices"),l=await files.A.dir_get_files(_),o=r.Id+".json";l=l.filter((e=>e.name.match(/\.json$/)&&e.name!=o));for(let e of l){for(;ut.A.locked(e.name);)await ut.A.lock(e.name);let a=ut.A.new_named_lock(e.name),[n,r]=await files.A.read_file(e),s=obj(r);null!=s?(null==s.Obj2Load[t]&&(s.Obj2Load[t]=[]),s.Obj2Load[t]=s.Obj2Load[t].concat(i),s.Obj2Load[t]=[...new Set(s.Obj2Load[t])],await files.A.write_file(e,str(s,null,4)),a()):a()}}else loge("idb.js/mark_changed: gfs.Rootdir is null")}static async sync_after_open(e){if(null!=gfs.A.Rootdir){var t=(await idb_thisclass.reopen(e)).transaction("wpower",RO),i=await idb_thisclass.find_one(t,{key:"device-info"});if(null!=i){var a="#devices/"+i.Value.Id+".json";if(await files.A.dir_file_exists(gfs.A.Rootdir,a)){var n=await files.A.dir_path2file(gfs.A.Rootdir,a),[r,s]=await files.A.read_file(n),_=obj(s);if(null!=_&&0!=keys(_.Obj2Load).length){for(let t of keys(_.Obj2Load)){let i=_.Obj2Load[t];if(null!=i&&0!=i.length){index_ui.A.notif(__h("LOADING")+" "+t+` (${i.length} ${__h("LC_ITEMS")})`);for(let a of i){let i=await files.A.dir_path2file(gfs.A.Rootdir,`#idb/${t}/${a}.json`),[n,r]=await files.A.read_file(i),s=obj(r);if(null!=s)if(keys(s).length>0){let i;delete s.id,log(`Loading to ${t}: ${s.Idstr}`);let a=(await idb_thisclass.reopen(e)).transaction(t,RW);await idb_thisclass.upsert_one(a,{idstr:s.Idstr},s,i=!1)}else{let i;log(`Removing from ${t}: ${s.Idstr}`);let a=(await idb_thisclass.reopen(e)).transaction(t,RW);await idb_thisclass.remove_one(a,{idstr:s.Idstr},i=!1)}}delete _.Obj2Load[t]}}await files.A.write_file(n,str(_,null,4))}}else log("Esbun: Nothing to sync in")}}else log("idb.js/sync_after_open: gfs.Rootdir is null")}_____Single_Doc_____(){}static async insert_one(e,t,i=null,a=!0){null==t.Idstr&&(t.Idstr=idstr());var n=s1(e),r=n.add(t),[s,_]=new_lock();r.onsuccess=e=>{null!=i&&i(e.target.result),_(e.target.result)},r.onerror=e=>{loge("idb.js/insert_one:",e.target.error)};var l=await s;return"fts"!=n.name&&fts_0.upsert_tokens(e.db.name,n.name,t,t.Idstr),!0===idb_thisclass.syncable&&null!=t.Idstr&&(idb_thisclass.sync_after_insert(n.name,t.Idstr,t),a&&idb_thisclass.mark_changed(e.db.name,n.name,t.Idstr)),l}static async find_one(e,t){return await idb_thisclass.find(e,t,!0,!0)}static async update_one(e,t,i,a=!0){var n=await idb_thisclass.find_one(e,t);if(null!=n){var r=n.id;delete n.id,delete i.id,(n={...n,...i}).id=r,await idb_thisclass.set_by_id(e,n);var s=r;return"fts"!=s1(e).name&&fts_0.upsert_tokens(e.db.name,s1(e).name,n,n.Idstr),!0===idb_thisclass.syncable&&null!=n.Idstr&&(idb_thisclass.sync_after_update(s1(e).name,n.Idstr,n),a&&idb_thisclass.mark_changed(e.db.name,s1(e).name,n.Idstr)),s}}static async upsert_one(e,t,i,a=!0){var n=await idb_thisclass.find_one(e,t);if(null==n)return delete i.id,await idb_thisclass.insert_one(e,i,null,a);var r={...n,...i};return delete r.id,await idb_thisclass.update_one(e,t,r,a)}static async remove_one(e,t,i=!0){var a=await idb_thisclass.find(e,t,!0,!0);if(null!=a){var n=a.id;if(null!=n){var r=await idb_thisclass.del_by_id(e,n);return"fts"!=s1(e).name&&fts_0.remove_tokens(e.db.name,s1(e).name,a,a.Idstr),!0===idb_thisclass.syncable&&null!=a.Idstr&&(idb_thisclass.sync_after_remove(s1(e).name,a.Idstr),i&&idb_thisclass.mark_changed(e.db.name,s1(e).name,a.Idstr)),r}}}_____Multidocs_____(){}static async insert_many(e,t,i=!0){var a=[],n=[],r=[];for(let i of t)i.Idstr=idstr(),r.push(i.Idstr),n.push(idb_thisclass.insert_one(e,i,(e=>{a.push(e)}),!1));await Promise.all(n);var s=a.sort();return idb_thisclass.syncable&&r.length>0&&i&&idb_thisclass.mark_changed(e.db.name,s1(e).name,r),s}static async find_many(e,t){return await idb_thisclass.find(e,t,!1,!0)}static async update_many(e,t,i,a=!0){var n=await idb_thisclass.find(e,t,!1,!0),r=[];delete i.id;for(let t=0;t<n.length;t++)n[t]={...n[t],...i},r.push(idb_thisclass.set_by_id(e,n[t]));await Promise.all(r);var s=n.map((e=>e.id)).sort(),_=[];if("fts"!=s1(e).name)for(let t of n)fts_0.upsert_tokens(e.db.name,s1(e).name,t,t.Idstr);for(let t of n)idb_thisclass.syncable&&null!=t.Idstr&&(idb_thisclass.sync_after_update(s1(e).name,t.Idstr,t),_.push(t.Idstr));return idb_thisclass.syncable&&_.length>0&&a&&idb_thisclass.mark_changed(e.db.name,s1(e),_),s}static async upsert_many(e,t,i,a=!0){}static async remove_many(e,t,i=!0){var a=await idb_thisclass.find(e,t,!1,!0);if(null!=a&&0!=a.length){var n=a.map((e=>e.id)),r=[];for(let t=0;t<n.length;t++){let i=a[t].id;r.push(idb_thisclass.del_by_id(e,i))}await Promise.all(r);var s=n,_=[];if("fts"!=s1(e).name)for(let t of a)fts_0.remove_tokens(e.db.name,s1(e).name,t,t.Idstr);for(let t of a)idb_thisclass.syncable&&null!=t.Idstr&&(idb_thisclass.sync_after_remove(s1(e).name,t.Idstr),_.push(t.Idstr));return idb_thisclass.syncable&&_.length>0&&i&&idb_thisclass.mark_changed(e.db.name,s1(e).name,_),s}}static async count_all(e,t=null){var i=s1(e);if(null==t)var a=i.count();else a=i.index(t).count();var[n,r]=new_lock();return a.onsuccess=e=>{r(e.target.result)},await n}static async count_range(e,t,i){var a=s1(e);if("id"==t)var n=a.count(i);else n=a.index(t).count(i);var[r,s]=new_lock();return n.onsuccess=e=>{s(e.target.result)},await r}static async count_with_conds(e,t){return(await idb_thisclass.find(e,t,!1,!1)).length}static async filter(e,t){t=idb_thisclass.parse_cond(t);var i=[],a=keys(t).length;return await idb_thisclass.open_cursor(e,"id",gte(0),D_AZ,((e,n)=>{let r=[];for(let e in t){let i=t[e],a=range2name(i),s=i.lower,_=i.upper,l=s==_?s:null;"eq"==a?n[e]==l?r.push(1):r.push(0):"gte"==a?n[e]>=s?r.push(1):r.push(0):"gt"==a?n[e]>s?r.push(1):r.push(0):"lte"==a?n[e]<=_?r.push(1):r.push(0):"lt"==a?n[e]<_?r.push(1):r.push(0):"in_with_lr"==a?n[e]>=s&&n[e]<=_?r.push(1):r.push(0):"in_without_lr"==a?n[e]>s&&n[e]<_?r.push(1):r.push(0):"in_with_r"==a?n[e]>s&&n[e]<=_?r.push(1):r.push(0):"in_with_l"==a&&(n[e]>=s&&n[e]<_?r.push(1):r.push(0))}r.reduce(((e,t)=>e+t),0)==a&&i.push(n)})),i}_____FTS_____(){}static async find_text(e,t,i){return await fts_0.find_text(e,t,i)}_____SYNC_____(){}static async sync_export_all(e,t){if(!0===idb_thisclass.syncable)if(null!=t)if(null!=gfs.A.Rootdir){try{await files.A.make_rw(gfs.A.Rootdir)}catch{return void loge("idb.js/sync_export_all: gfs.Rootdir has no RW permissions")}var i=idb_thisclass.Nosyncs.concat(t);i=[...new Set(i)];var a=await idb_thisclass.get_store_names(e);a=a.filter((e=>-1==i.indexOf(e)));for(let t of a){log("idb.js: Exporting store",t);let i=(await idb_thisclass.reopen(e)).transaction(t,RW),a=await idb_thisclass.find_many(i,{});log("idb.js: Items found:",a.length);for(let e of a){if(null==e.Idstr)continue;let i=e.Idstr,a=await files.A.dir_path2file(gfs.A.Rootdir,`#idb/${t}/${i}.json`);await files.A.write_file(a,str(e,null,4))}}log("idb.js: Export done.")}else loge("idb.js/sync_export_all: gfs.Rootdir is null, gfs.init is needed");else loge("idb.js/sync_export_all: Excluded_Stores can't be null");else loge("idb.js/sync_export_all: Must open db with open_syncable")}static async sync_import_all(e,t){if(!0===idb_thisclass.syncable)if(null!=t)if(null!=gfs.A.Rootdir){try{await files.A.make_rw(gfs.A.Rootdir)}catch{return void loge("idb.js/sync_export_all: gfs.Rootdir has no RW permissions")}var i=idb_thisclass.Nosyncs.concat(t);i=[...new Set(i)];var a=await files.A.dir_path2dir(gfs.A.Rootdir,"#idb"),n=(await files.A.dir_get_subdirs(a)).map((e=>e.name));n=n.filter((e=>-1==i.indexOf(e)));for(let t of n){log("idb.js: Importing dir",t);let i=await files.A.dir_path2dir(gfs.A.Rootdir,"#idb/"+t),a=await files.A.dir_get_files(i);log("idb.js: Items found:",a.length);for(let i of a){let[a,n]=await files.A.read_file(i),r=obj(n);if(null==r){loge("idb.js/sync_import_all: Bad JSON file:",i.name);continue}if(null==r.Idstr)continue;delete r.id;let s,_=(await idb_thisclass.reopen(e)).transaction(t,RW);await idb_thisclass.upsert_one(_,{idstr:r.Idstr},r,s=!1)}}log("idb.js: Import done.")}else loge("idb.js/sync_export_all: gfs.Rootdir is null, gfs.init is needed");else loge("idb.js/sync_export_all: Excluded_Stores can't be null");else loge("idb.js/sync_export_all: Must open db with open_syncable")}_____MISCS_____(){}_____Cursors_____(){}static async open_id_cursor(e,t,i,a){var n=s1(e).openCursor(t,i),[r,s]=new_lock();n.onsuccess=async e=>{let t=e.target.result;t?"stop"==await a(t.key,t.value,{update:t.update,remove:t.delete})?s():t.continue():s()},await r}static async open_id_keycursor(e,t,i,a){var n=s1(e).openKeyCursor(t,i),[r,s]=new_lock();n.onsuccess=async e=>{let t=e.target.result;t?"stop"==await a(t.key,{update:t.update,remove:t.delete})?s():t.continue():s()},await r}static async open_cursor(e,t,i,a,n){if("id"==t)return await idb_thisclass.open_id_cursor(e,i,a,n);var r=s1(e).index(t).openCursor(i,a),[s,_]=new_lock();r.onsuccess=async e=>{let t=e.target.result;t?"stop"==await n(t.key,t.value,{update:t.update,remove:t.delete})?_():t.continue():_()},await s}static async open_keycursor(e,t,i,a,n){if("id"==t)return await idb_thisclass.open_id_keycursor(e,i,a,n);var r=s1(e).index(t).openKeyCursor(i,a),[s,_]=new_lock();r.onsuccess=async e=>{let t=e.target.result;t?"stop"==await n(t.key,{update:t.update,remove:t.delete})?_():t.continue():_()},await s}_____Info_____(){}_____TESTS_____(){}static async insert(e,t,i){var a=(await idb_thisclass.reopen(e)).transaction(t,RW);return await idb_thisclass.insert_one(a,i)}static async test(){}}window.idb=idb,window.idstr=idb.new_idstr;const idb_thisclass=idb,idb_0=idb_thisclass;var enc=__webpack_require__(834);function graph_CLASS_(){}class graph{static Nonodes=["wpower","fts","metadata"];_____NODES_____(){}static async create_node(e,t,i){if(!(graph_thisclass.Nonodes.indexOf(t)>=0)){var a=(await idb_0.reopen(e)).transaction("graph",RW);await idb_0.upsert_one(a,{node_store:t,node_idstr:i},{Node_Store:t,Node_Idstr:i,Nexts:[],is_pinned:!1,Edge_Names:{}})}}static async read_node(e,t){var i=(await idb_0.reopen(e)).transaction("graph",RO);return await idb_0.find_one(i,{idstr:t})}static async update_node(e,t,i){var a=(await idb_0.reopen(e)).transaction("graph",RW);i.Nexts&&await idb_0.update_one(a,{idstr:t},{Nexts:i.Nexts})}static async del_node(e,t){var i=(await idb_0.reopen(e)).transaction("graph",RW);await idb_0.remove_one(i,{idstr:t})}_____EDGES_____(){}static async create_edge(e,t,i){var a=(await idb_0.reopen(e)).transaction("graph",RW),n=await idb_0.find_one(a,{idstr:t});null!=n&&(n.Nexts=[...new Set(n.Nexts.concat([i]))],await idb_0.update_one(a,{idstr:t},{Nexts:n.Nexts}))}static async update_edge(e,t,i,a){var n=(await idb_0.reopen(e)).transaction("graph",RW);if(a.Name){let e=await idb_0.find_one(n,{idstr:t});if(null==e)return;e.Edge_Names[i]=a.Name,await idb_0.update_one(n,{idstr:t},{Edge_Names:e.Edge_Names})}}static async del_edge(e,t,i){var a=(await idb_0.reopen(e)).transaction("graph",RW),n=await idb_0.find_one(a,{idstr:t});null!=n&&(delete n.Edge_Names[i],n.Nexts=n.Nexts.filter((e=>e!=i)),await idb_0.update_one(a,{idstr:t},{Nexts:n.Nexts,Edge_Names:n.Edge_Names}))}_____UTILS_____(){}static async set_as_pin(e,t){var i=(await idb_0.reopen(e)).transaction("graph",RW);await idb_0.update_one(i,{idstr:t},{is_pinned:!0})}static async get_pins(e){var t=(await idb_0.reopen(e)).transaction("graph",RO);return await idb_0.find_many(t,{is_pinned:!0})}static async remove_pin(e,t){var i=(await idb_0.reopen(e)).transaction("graph",RW);await idb_0.update_one(i,{idstr:t},{is_pinned:!1})}}window.graph_=graph;const graph_thisclass=graph,graph_0=graph_thisclass,index={base_controller:base_controller.A,cvm:index_cvm.A,files:files.A,lang:lang_0,net:net.A,ui:index_ui.A,ut:ut.A,idb:idb_0,enc:enc.A,gfs:gfs.A,graph:graph_0};export{index as default};